An efficient method to identify differentially expressed genes in microarray experiments Motivation Microarray experiments typically analyze thousands to tens of thousands of genes from small numbers of biological replicates. The fact that genes are normally expressed in functionally relevant patterns suggests that gene-expression data can be stratified and clustered into relatively homogenous groups. Cluster-wise dimensionality reduction should make it feasible to improve screening power while minimizing information loss. Results We propose a powerful and computationally simple method for finding differentially expressed genes in small microarray experiments. The method incorporates a novel stratification-based tight clustering algorithm, principal component analysis and information pooling. Comprehensive simulations show that our method is substantially more powerful than the popular SAM and eBayes approaches. We applied the method to three real microarray datasets: one from a Populus nitrogen stress experiment with 3 biological replicates; and two from public microarray datasets of human cancers with 10 to 40 biological replicates. In all three analyses, our method proved more robust than the popular alternatives for identification of differentially expressed genes. Availability The C++ code to implement the proposed method is available upon request for academic use.  3.4 The basis for the forward search tight clustering The correlations between genes of different expression patterns have distinct properties. Let ?? be a generic notation of the correlation between two genes. We distinguish three hierarchies for ?? : (1) between two differentially expressed genes, (2) between a differentially expressed gene and a stably expressed gene and (3) between two stably expressed genes. The proposed tight clustering is based on our simulation studies on gene-to-gene correlations. In our method, the probability Pr( ?? > ? 0) reflects the likelihood of assigning two genes of interest into a cluster of tightness ? 0. To illustrate the distribution properties of ??, we sampled the expression indices of two genes exhibiting bivariate normal distribution in a control group with mean 0, variance 1 and correlation ? and bivariate normal distribution in a treatment group with mean ( ?, ? )? , variance 1 and correlation ?. For given differential expression ( ?,? )? the probability Pr( ?? > ? 0) increased with residual correlation ? ( Fig. 3 and Fig. S3 ). This is consistent with classical sample correlation. These figures also show three particular characteristics of gene-to-gene correlations, which clearly differ from classical sample correlations. First, the distribution of the correlation between two similarly up-or downregulated genes (i.e. ? = ? ? = 0) can be dramatically affected by the magnitude of differential ?. The larger the magnitude, the larger the probability Pr( ?? > ? 0) , and the more likely the two genes will be clustered together. As shown in Figure 3a–b and Figure S3a–b , the correlation between two differentially expressed genes was likely to be large if the magnitude of the differential was large. This was also true even if the residual of the two genes were completely independent ( ? = 0). As ? = 5 and ? = 0 , Pr( ?? > 0.8) = 0.9091 in Figure 3a and Pr( ?? > 0.8) = 0.9585 in Figure S3a . The probability decreased as ? decreased. As ? = 3 and ? = 0 , Pr( ?? > 0.8) = 0.4798 in Figure 3b and Pr( ?? > 0.8) = 0.0072 in Figure S3b . Given ? = 0, Pr( ?? > 0.8) decreased to 0.032 in Figure 3c and to 0 in Figure S3c when ? decreased to 0. Since high gene-to-gene correlations likely occur between similarly up- or downregulated genes with large differentials, the proposed method tends to assign those genes with the largest differentials to a common cluster in early iteration steps. Second, the correlation between a stably expressed gene and a differentially expressed gene is unlikely to be large. This was especially the case when the magnitude of differential was large, even when the residual correlation ? was close to 1. As ? = 3, Pr( ?? > 0.8) ? 0.1354 in Figure 3d and Pr( ?? > 0.8) ? 0.0001 in Figure S2d for ? ? [0 , 1]. As ? = 10 , Pr( ?? > 0.8) ? 0.0518 in Figure 3e and Pr( ?? > 0.8) = 0 in Figure S3e for ? ? [0 , 1]. These upper bounds were achieved at ? = 1 , and for fixed ? the probability Pr( ?? ? 0) declined as ? decreased. Thus, the proposed forward-search tight clustering method reduced the chance of assigning a stable gene to a differentially expressed cluster, and vice versa. Third, Figure 3c–e and Figure S3c–e show two properties of the correlation ?? between a stably expressed gene and a differentially expressed gene: (1) The distribution of ?? is invariant to ? if the two genes are independent ( ? = 0). Precisely, independence means ? = ( n ?2)1/2 ?? (1 ? ?? 2)?1/2 ~ t n ?2 (the student t with n ? 2 degrees of freedom) for arbitrary ? . (2) For arbitrary ? ? [0 , 1] ,? converges in distribution to t n ?2 as ? ? +?. As ? increases, the curves with respect to positive residual correlations decline toward the benchmark curve of an independent stably expressed pair. By these properties, one may control the possibility of clustering a gene of fixed differential expression with a stably expressed gene by choosing a suitable tightness correlation threshold. Classical correlation theory applies for the correlation ?? between two stably expressed genes ( ? = ? = 0). In such a case, ?? is well-known to converge in probability to the residual correlation ? as sample size increases. The distribution of ?? is mainly affected by ? for a finite sample size. The larger the residual correlation, the more likely ?? exceeded a given threshold ( Fig. 3c and Fig. S3c ). In microarray experiments, there are more stably expressed genes than differentially expressed genes in general. Hence, the forward-search tight clustering is especially efficient as there are large residual correlations among stably expressed genes.  3.5 Parameters that affect FCPC Two user-defined parameters, the maximum substratum size L and the tightness level T impact the tight cluster sizes and hence the sensitivity, specificity and the computational efficiency of the FCPC. In our simulations, we investigated four sets of tightness levels: T 1 ={0.9, 0.8, 0.7, 0.6} and Ti = T 1? 0.1×( i ?1) for i = 2 , 3 , 4. For each Ti we calculated the power and FDR of the FCPC with L =50, 100, 1000, 2000 and 5000 as applicable. The power of the FCPC appeared robust as L changed for a given T ( Figs S4a and S5a ). In general, using large L would reduce computational efficiency and increase the possibility of mixing noise genes and genes that are only marginally differentially expressed. We recommend performing tight clustering within substrata of sizes 100 or so. Using less stringent tightness levels could boost statistical power at the expense of inflating FDR, especially for a very small nominal FDR. In our simulations, T 1 yielded the most stringent control of FDR and was the most computationally demanding. T 2 controlled FDR very well even as G = 50 000 ( Table 1 ), with considerably improved computational efficiency.  4 APPLICATIONS TO REAL MICROARRAY DATASETS 4.1 Nitrogen deficiency in Populus We applied FCPC and eBayes to analyze the transcriptomic response of Populus fremontii × angustifolia to nitrogen deficiency using the GeneChip® Poplar Genome Array (Affymetrix). Raw hybridization signals were processed by the Affymetrix MAS 5.0 software, and only probe sets identified as ‘present’ in all three control and three nitrogen stress replicates were analyzed further. The resultant 13 507 probe sets were separated into up- (6202) and downregulated (7305) strata. Of the 6202 probe sets in the upregulated stratum, 5368 were represented by 2206 tight clusters, likewise, 6478 of the 7305 probe sets in the downregulated stratum were covered in 2196 tight clusters, and we had 1630 scattered genes. At the nominal FDR ? =0.05, the FCPC method detected 410 significantly up- and 189 significantly downregulated genes, and eBayes identified 143 up-and 90 downregulated genes. Further examination of the significant results from each procedure revealed discrepancies in terms of the genes identified. Table 4 lists the 10 downregulated discoveries based on the highest expression differentials and the 10 downregulated discoveries based on the smallest expression differentials found by eBayes and FCPC. Half of the discoveries by FCPC from the most significantly downregulated stratum were not captured by eBayes (see the genes and relative expression ratios in boldface in panel a of Table 4 ). FCPC also outperformed eBayes in capturing weakly but statistically significantly downregulated genes ( Table 4 , panel b). For instance, the 10 most weakly downregulated genes discovered by FCPC were completely missed by eBayes. All 10 FCPC discoveries shown in panel b of Table 4 were ? 1.3-fold downregulated, versus only 1 by eBayes. We also analyzed this dataset using various tightness levels ( Tables S1 and S2 ). Using less stringent tightness levels had no effect on strongly downregulated genes ( Table S2a ), but captured more genes with weak expression differentials ( Table S2b ). Although biological significance of these weakly downregulated candidate genes requires follow-up analysis, FCPC nevertheless provides a more sensitive means than eBayes in capturing more candidate genes for subsequent investigations. 4.2 Human diseases Having applied the FCPC method to the low-replicate plant microarray experiment, we then turned to investigate its performance in microarray datasets of human cancers (colon cancer and leukemia), in which there were more biological replicates. The basic features of the colon data were described in Section 3.2. The leukemia dataset was from Golub et al . (1999) . This dataset contained expression indices of 7129 genes of 11 AML and 27 ALL, where 3051 genes remained after filtering and preprocessing as done by the authors. We applied FCPC and eBayes to the filtered genes as summarized in panel a of Table 5 . FCPC claimed 49 and 54 more genes to be differentially expressed than eBayes in the colon and leukemia datasets, respectively, as shown in panel b of Table 5 . Using the leukemia dataset as an example, eBayes discovered 357 significantly upregulated genes and 312 significantly downregulated genes, while FCPC discovered 394 and 329, respectively. As with the low-replicate experiment reported above, lowering the tightness levels led to more significant gene discoveries, as shown in Table S3 . Taken together, these analyses showed that FCPC performs as well as, or slightly better than eBayes when applied to microarray experiments with high biological replication. However, FCPC is substantially more robust than eBayes for significant gene discoveries in low-replicate experiments.  4.1 Nitrogen deficiency in Populus We applied FCPC and eBayes to analyze the transcriptomic response of Populus fremontii × angustifolia to nitrogen deficiency using the GeneChip® Poplar Genome Array (Affymetrix). Raw hybridization signals were processed by the Affymetrix MAS 5.0 software, and only probe sets identified as ‘present’ in all three control and three nitrogen stress replicates were analyzed further. The resultant 13 507 probe sets were separated into up- (6202) and downregulated (7305) strata. Of the 6202 probe sets in the upregulated stratum, 5368 were represented by 2206 tight clusters, likewise, 6478 of the 7305 probe sets in the downregulated stratum were covered in 2196 tight clusters, and we had 1630 scattered genes. At the nominal FDR ? =0.05, the FCPC method detected 410 significantly up- and 189 significantly downregulated genes, and eBayes identified 143 up-and 90 downregulated genes. Further examination of the significant results from each procedure revealed discrepancies in terms of the genes identified. Table 4 lists the 10 downregulated discoveries based on the highest expression differentials and the 10 downregulated discoveries based on the smallest expression differentials found by eBayes and FCPC. Half of the discoveries by FCPC from the most significantly downregulated stratum were not captured by eBayes (see the genes and relative expression ratios in boldface in panel a of Table 4 ). FCPC also outperformed eBayes in capturing weakly but statistically significantly downregulated genes ( Table 4 , panel b). For instance, the 10 most weakly downregulated genes discovered by FCPC were completely missed by eBayes. All 10 FCPC discoveries shown in panel b of Table 4 were ? 1.3-fold downregulated, versus only 1 by eBayes. We also analyzed this dataset using various tightness levels ( Tables S1 and S2 ). Using less stringent tightness levels had no effect on strongly downregulated genes ( Table S2a ), but captured more genes with weak expression differentials ( Table S2b ). Although biological significance of these weakly downregulated candidate genes requires follow-up analysis, FCPC nevertheless provides a more sensitive means than eBayes in capturing more candidate genes for subsequent investigations.  4.2 Human diseases Having applied the FCPC method to the low-replicate plant microarray experiment, we then turned to investigate its performance in microarray datasets of human cancers (colon cancer and leukemia), in which there were more biological replicates. The basic features of the colon data were described in Section 3.2. The leukemia dataset was from Golub et al . (1999) . This dataset contained expression indices of 7129 genes of 11 AML and 27 ALL, where 3051 genes remained after filtering and preprocessing as done by the authors. We applied FCPC and eBayes to the filtered genes as summarized in panel a of Table 5 . FCPC claimed 49 and 54 more genes to be differentially expressed than eBayes in the colon and leukemia datasets, respectively, as shown in panel b of Table 5 . Using the leukemia dataset as an example, eBayes discovered 357 significantly upregulated genes and 312 significantly downregulated genes, while FCPC discovered 394 and 329, respectively. As with the low-replicate experiment reported above, lowering the tightness levels led to more significant gene discoveries, as shown in Table S3 . Taken together, these analyses showed that FCPC performs as well as, or slightly better than eBayes when applied to microarray experiments with high biological replication. However, FCPC is substantially more robust than eBayes for significant gene discoveries in low-replicate experiments.  5 DISCUSSION In this article, we present a powerful and computationally simple method, FCPC, to detect differentially expressed genes from microarray data. The method integrates the strengths of stratification, tight clustering, data compression, information pooling and standard Benjamini–Hochberg FDR correction. We evaluated FCPC by simulation studies as well as by application to a real dataset. Simulation results show that FCPC controls FDR and is much more powerful than the popular approaches when the number of genes is large. The basis for the FCPC approach is 2-fold. First, expression indices that vary between different experimental conditions can reveal certain regulatory strata. Genes within one common stratum may be more related functionally, at the organismal level, than genes from different strata. This serves as the basis for stratification. Second, gene-expression indices are correlated in various clumps ( Qiu et al ., 2005 ; Storey, 2003 ). This serves as the basis for correlation-based clustering. The rational of the iterative clustering method we employed deserves special mention. Clustering was done progressively, and with a correlation threshold in order to maximize the tightness of early formed clusters. We designed the method according to our observations on the sampling distributions of gene-to-gene correlation. A correlation threshold can be chosen such that the sample correlation between similarly up- or downregulated genes will most likely exceed that threshold, while the correlation between a stably expressed gene and a differentially expressed gene is unlikely to meet the threshold. Therefore, the proposed clustering method can distinguish differentially expressed genes from stably expressed genes during the early iterations, and organize them into tight clusters. In addition, the correlation between two stably expressed genes is likely larger than a threshold if the residual correlation is strong. This integration proved to efficiently prevent loss of statistical power and the flood of false discoveries. The observations in Section 3.4 are helpful for defining the tightness parameters to find stable clusters. It is very difficult to find the optimal set of tightness levels without information about the residual correlations. According to our simulations and observations of the properties of gene-to-gene correlation, T 1 and T 2 are reasonable choices. Analysis of real data as in Section 4 appeared to validate the dependence between genes, as use of these tightness levels resulted in the clustering of most genes. The gene-to-gene correlation is affected by many factors such as expression differential, residual correlations and the variance deviation across conditions, but the theoretical basis remains under-investigated. Nevertheless, the proposed FCPC approach provides a powerful and efficient means for assessing the various parameters as part of the microarray data analysis for identification of differentially expressed genes.  Supplementary Material Suppl  3 SIMULATION STUDIES It has been reported that SAM has difficulties in FDR control and estimation ( Dudoit et al ., 2003 ; Pan, 2002 ; Zhang, 2007 ). For small experiments, the empirical estimate of FDR in SAM may be misleading. We thus adopted average power and FDR as performance criteria. Applying a method to the r -th simulated dataset (1 ? r ? R ), we may claim D r positives, where D? r are among the D differentially expressed genes. We defined power = ( RD )?1 ( D? 1 + ··· + D? R ) as the average probability of rejecting the false null hypotheses, referred to as the average power in Dudoit et al . (2003) . Similarly, we calculated FDR = 1 - R - 1 ? r ? R D r - 1 D ? r , where ? = { r: D r > 0 , 1 ? r ? R }. Using common datasets, we calculated average powers and FDRs of SAM along a threshold list, and those of the other two statistical approaches, along a nominal FDR list. 3.1 Clumpy mean–variance model We designed our simulation dataset based on the fact that genes are usually expressed in functionally relevant patterns, contributing to the mosaic dependence structure of microarray data. Described as ‘clumpy dependence’ by Storey (2003) , it depicts the scenario that genes are dependent in small, functionally relevant groups but independent among groups. In actual microarray experiments (or biological systems), the ‘clump’ sizes are likely to vary from a few to several dozens, depending on associated pathways/processes and/or microarray design (e.g. probe redundancy). In addition, as shown in Hu and Wright (2007) , different genes may have distinct expression deviations. We therefore simulated gene-expression indices from a clumpy mean–variance model. First, we generated a G × n background matrix X by iterating two steps below: (1) Randomly select clump size m from {1,2,…,100} and clump-wise correlation ? from U (0.5 , 1). (2) For a given ( m, ? ) pair, generate m ×1 noise vectors e · j from N ( 0 m , ( 1 - ? ) I m + ? 1 m 1 m ? ) and let x · j = ? +diag( ? ) e · j be the expression indices of the m genes in the clump at array j = 1 , … , n = n 1 + n 2 , where ? is an m × 1 vector of elements ? g ~ 1000 ? 5 2 , and ?, an m × 1 vector of elements ? g = e ? 0 / 2 ? g ? 1 / 2 , and ? 0 and ? 1 are two constants for all G genes. In this design we set ? 0 = ?5 ,? 1 = 2 and n 1 = n 2 = 4. Second, we similarly generated gene clumps containing 150 background expression indices and added 2?1/2 ? g? g to x gj for all j > 4 to have gene g be upregulated, where ? g was sampled from U (4 , 10) such that the true regulation ratio 1+2?1/2 e ?2 ? g ~ U (1.2322, 1.5804). In a similar way, we generated clumps containing 150 downregulated genes. Finally, we randomly replaced 300 rows of the background matrix X by the 300 differentially expressed genes so that no clumps were enriched by differentially expressed genes. We mimicked gene-expression indices of clump-wise correlations and various gene-specific means and variances. We varied G from 1000 to 50 000 and for each given number we simulated 1000 datasets to calculate the FDR and power for each method. In terms of power for a given FDR, the FCPC notably distinguished itself from the other three methods, with eBayes second, closely followed by SAMCV and SAM50 ( Fig. 1 ). Both the FCPC and the eBayes controlled FDR fairly well, close to the nominal level as shown in Table 1 . In contrast, it would be difficult to select the threshold in the SAM approaches to control FDR at a nominal level, especially for very small sample sizes. The FCPC is preferable to the eBayes in terms of the relative power gain defined as ( ? FCPC ? ? FCPC) × ( ? eBayes ? ? eBayes)?1 ?1, where ? ’s and ? ’s were the power and FDR of the specified approaches. Setting nominal FDR at 0.05 and G =20 000, we obtained ? FCPC = 0.785 , ? FCPC = 0.032 , ? eBayes =0.705 and ? eBayes = 0.054. In such a scenario, the relative power gain of the FCPC over the eBayes was 16%. Under the same nominal FDR, the relative power gain increased as G increased, and approached 34% as G =50 000 ( Fig. S1 ). 3.2 Sampling from the colon dataset The dependence in real datasets should be much more complicated than the clumpy mean–variance model. To illustrate the advantages of the FCPC when sample size is very small, we sampled the colon dataset from Alon et al . (1999) . In that dataset, expression indices of 40 tumor and 22 normal colon tissues for 6600 human genes were measured using the Affymetrix GeneChip. A subset of 2000 genes with the highest minimal signal intensity across the samples was chosen by the authors for further analysis. From the subset, we removed 472 genes such that 1 < |? g | ?2 , where ? g = log( x? 2 g/x? 1 g ). For each gene g with ? g > 2 we added 0.6-fold of gene-specific range to every expression index in the treatment to mimic an upregulated gene. At the same time, for each gene g with ? g < ?2 we added 0.6-fold of gene-specific range to every expression index in the control to mimic a downregulated gene. As such, we artificially introduced 102 differentially expressed genes and had 1426 stably expressed genes. We randomly sampled 2 out of the 40 tumor arrays and 2 out of the 22 normal arrays for testing with the FCPC and its alternatives. We repeated this procedure 1000 times and calculated the FDR and power of each approach. Here again, the FCPC clearly outperformed the other three methods in terms of power, especially at lower FDR levels ( Fig. 2 ). The SAM50 ranked second, closely followed by the eBayes. The SAMCV was the last. At nominal FDR 0.05, the FCPC and eBayes controlled FDR at 0.040 and 0.048 and with a power of 0.433 and 0.141, respectively. The relative power gain of the FCPC over the eBayes was thus 323%. Given the small sample size, the empirical estimate of FDR in SAMCV appears to be unreasonable ( Table 2 ). In some cases, the empirical estimates unacceptably differed from the corresponding FDRs. 3.3 The representativeness of the first PC The representativeness of the first PC for each tight cluster was evaluated by ? in Section 2.3. Table 3 shows the distribution and certain mathematical characteristics of the ? -values of 427 806 tight clusters produced by 1000 simulated 5000×8 datasets from the clumpy mean–variance model described in Section 3.1. There were 329 978 clusters at tightness ?0.8, and 55 367 clusters at tightness 0.7 to 0.8 ( Table 3 ). The number of clusters decreased rapidly as the level of tightness declined. At each tightness level, the median and mean were large, and the coefficient of variance was very small. In general, the first PC of a tight cluster represented the cluster fairly well. On average, the first PC explained greater than 87% of the total variance ( Table 3 , see the smallest mean and median). Additional details for first PCs of tightness ? 0.8 are shown in Fig. S2 . 3.4 The basis for the forward search tight clustering The correlations between genes of different expression patterns have distinct properties. Let ?? be a generic notation of the correlation between two genes. We distinguish three hierarchies for ?? : (1) between two differentially expressed genes, (2) between a differentially expressed gene and a stably expressed gene and (3) between two stably expressed genes. The proposed tight clustering is based on our simulation studies on gene-to-gene correlations. In our method, the probability Pr( ?? > ? 0) reflects the likelihood of assigning two genes of interest into a cluster of tightness ? 0. To illustrate the distribution properties of ??, we sampled the expression indices of two genes exhibiting bivariate normal distribution in a control group with mean 0, variance 1 and correlation ? and bivariate normal distribution in a treatment group with mean ( ?, ? )? , variance 1 and correlation ?. For given differential expression ( ?,? )? the probability Pr( ?? > ? 0) increased with residual correlation ? ( Fig. 3 and Fig. S3 ). This is consistent with classical sample correlation. These figures also show three particular characteristics of gene-to-gene correlations, which clearly differ from classical sample correlations. First, the distribution of the correlation between two similarly up-or downregulated genes (i.e. ? = ? ? = 0) can be dramatically affected by the magnitude of differential ?. The larger the magnitude, the larger the probability Pr( ?? > ? 0) , and the more likely the two genes will be clustered together. As shown in Figure 3a–b and Figure S3a–b , the correlation between two differentially expressed genes was likely to be large if the magnitude of the differential was large. This was also true even if the residual of the two genes were completely independent ( ? = 0). As ? = 5 and ? = 0 , Pr( ?? > 0.8) = 0.9091 in Figure 3a and Pr( ?? > 0.8) = 0.9585 in Figure S3a . The probability decreased as ? decreased. As ? = 3 and ? = 0 , Pr( ?? > 0.8) = 0.4798 in Figure 3b and Pr( ?? > 0.8) = 0.0072 in Figure S3b . Given ? = 0, Pr( ?? > 0.8) decreased to 0.032 in Figure 3c and to 0 in Figure S3c when ? decreased to 0. Since high gene-to-gene correlations likely occur between similarly up- or downregulated genes with large differentials, the proposed method tends to assign those genes with the largest differentials to a common cluster in early iteration steps. Second, the correlation between a stably expressed gene and a differentially expressed gene is unlikely to be large. This was especially the case when the magnitude of differential was large, even when the residual correlation ? was close to 1. As ? = 3, Pr( ?? > 0.8) ? 0.1354 in Figure 3d and Pr( ?? > 0.8) ? 0.0001 in Figure S2d for ? ? [0 , 1]. As ? = 10 , Pr( ?? > 0.8) ? 0.0518 in Figure 3e and Pr( ?? > 0.8) = 0 in Figure S3e for ? ? [0 , 1]. These upper bounds were achieved at ? = 1 , and for fixed ? the probability Pr( ?? ? 0) declined as ? decreased. Thus, the proposed forward-search tight clustering method reduced the chance of assigning a stable gene to a differentially expressed cluster, and vice versa. Third, Figure 3c–e and Figure S3c–e show two properties of the correlation ?? between a stably expressed gene and a differentially expressed gene: (1) The distribution of ?? is invariant to ? if the two genes are independent ( ? = 0). Precisely, independence means ? = ( n ?2)1/2 ?? (1 ? ?? 2)?1/2 ~ t n ?2 (the student t with n ? 2 degrees of freedom) for arbitrary ? . (2) For arbitrary ? ? [0 , 1] ,? converges in distribution to t n ?2 as ? ? +?. As ? increases, the curves with respect to positive residual correlations decline toward the benchmark curve of an independent stably expressed pair. By these properties, one may control the possibility of clustering a gene of fixed differential expression with a stably expressed gene by choosing a suitable tightness correlation threshold. Classical correlation theory applies for the correlation ?? between two stably expressed genes ( ? = ? = 0). In such a case, ?? is well-known to converge in probability to the residual correlation ? as sample size increases. The distribution of ?? is mainly affected by ? for a finite sample size. The larger the residual correlation, the more likely ?? exceeded a given threshold ( Fig. 3c and Fig. S3c ). In microarray experiments, there are more stably expressed genes than differentially expressed genes in general. Hence, the forward-search tight clustering is especially efficient as there are large residual correlations among stably expressed genes. 3.5 Parameters that affect FCPC Two user-defined parameters, the maximum substratum size L and the tightness level T impact the tight cluster sizes and hence the sensitivity, specificity and the computational efficiency of the FCPC. In our simulations, we investigated four sets of tightness levels: T 1 ={0.9, 0.8, 0.7, 0.6} and Ti = T 1? 0.1×( i ?1) for i = 2 , 3 , 4. For each Ti we calculated the power and FDR of the FCPC with L =50, 100, 1000, 2000 and 5000 as applicable. The power of the FCPC appeared robust as L changed for a given T ( Figs S4a and S5a ). In general, using large L would reduce computational efficiency and increase the possibility of mixing noise genes and genes that are only marginally differentially expressed. We recommend performing tight clustering within substrata of sizes 100 or so. Using less stringent tightness levels could boost statistical power at the expense of inflating FDR, especially for a very small nominal FDR. In our simulations, T 1 yielded the most stringent control of FDR and was the most computationally demanding. T 2 controlled FDR very well even as G = 50 000 ( Table 1 ), with considerably improved computational efficiency.  3.1 Clumpy mean–variance model We designed our simulation dataset based on the fact that genes are usually expressed in functionally relevant patterns, contributing to the mosaic dependence structure of microarray data. Described as ‘clumpy dependence’ by Storey (2003) , it depicts the scenario that genes are dependent in small, functionally relevant groups but independent among groups. In actual microarray experiments (or biological systems), the ‘clump’ sizes are likely to vary from a few to several dozens, depending on associated pathways/processes and/or microarray design (e.g. probe redundancy). In addition, as shown in Hu and Wright (2007) , different genes may have distinct expression deviations. We therefore simulated gene-expression indices from a clumpy mean–variance model. First, we generated a G × n background matrix X by iterating two steps below: (1) Randomly select clump size m from {1,2,…,100} and clump-wise correlation ? from U (0.5 , 1). (2) For a given ( m, ? ) pair, generate m ×1 noise vectors e · j from N ( 0 m , ( 1 - ? ) I m + ? 1 m 1 m ? ) and let x · j = ? +diag( ? ) e · j be the expression indices of the m genes in the clump at array j = 1 , … , n = n 1 + n 2 , where ? is an m × 1 vector of elements ? g ~ 1000 ? 5 2 , and ?, an m × 1 vector of elements ? g = e ? 0 / 2 ? g ? 1 / 2 , and ? 0 and ? 1 are two constants for all G genes. In this design we set ? 0 = ?5 ,? 1 = 2 and n 1 = n 2 = 4. Second, we similarly generated gene clumps containing 150 background expression indices and added 2?1/2 ? g? g to x gj for all j > 4 to have gene g be upregulated, where ? g was sampled from U (4 , 10) such that the true regulation ratio 1+2?1/2 e ?2 ? g ~ U (1.2322, 1.5804). In a similar way, we generated clumps containing 150 downregulated genes. Finally, we randomly replaced 300 rows of the background matrix X by the 300 differentially expressed genes so that no clumps were enriched by differentially expressed genes. We mimicked gene-expression indices of clump-wise correlations and various gene-specific means and variances. We varied G from 1000 to 50 000 and for each given number we simulated 1000 datasets to calculate the FDR and power for each method. In terms of power for a given FDR, the FCPC notably distinguished itself from the other three methods, with eBayes second, closely followed by SAMCV and SAM50 ( Fig. 1 ). Both the FCPC and the eBayes controlled FDR fairly well, close to the nominal level as shown in Table 1 . In contrast, it would be difficult to select the threshold in the SAM approaches to control FDR at a nominal level, especially for very small sample sizes. The FCPC is preferable to the eBayes in terms of the relative power gain defined as ( ? FCPC ? ? FCPC) × ( ? eBayes ? ? eBayes)?1 ?1, where ? ’s and ? ’s were the power and FDR of the specified approaches. Setting nominal FDR at 0.05 and G =20 000, we obtained ? FCPC = 0.785 , ? FCPC = 0.032 , ? eBayes =0.705 and ? eBayes = 0.054. In such a scenario, the relative power gain of the FCPC over the eBayes was 16%. Under the same nominal FDR, the relative power gain increased as G increased, and approached 34% as G =50 000 ( Fig. S1 ).  3.2 Sampling from the colon dataset The dependence in real datasets should be much more complicated than the clumpy mean–variance model. To illustrate the advantages of the FCPC when sample size is very small, we sampled the colon dataset from Alon et al . (1999) . In that dataset, expression indices of 40 tumor and 22 normal colon tissues for 6600 human genes were measured using the Affymetrix GeneChip. A subset of 2000 genes with the highest minimal signal intensity across the samples was chosen by the authors for further analysis. From the subset, we removed 472 genes such that 1 < |? g | ?2 , where ? g = log( x? 2 g/x? 1 g ). For each gene g with ? g > 2 we added 0.6-fold of gene-specific range to every expression index in the treatment to mimic an upregulated gene. At the same time, for each gene g with ? g < ?2 we added 0.6-fold of gene-specific range to every expression index in the control to mimic a downregulated gene. As such, we artificially introduced 102 differentially expressed genes and had 1426 stably expressed genes. We randomly sampled 2 out of the 40 tumor arrays and 2 out of the 22 normal arrays for testing with the FCPC and its alternatives. We repeated this procedure 1000 times and calculated the FDR and power of each approach. Here again, the FCPC clearly outperformed the other three methods in terms of power, especially at lower FDR levels ( Fig. 2 ). The SAM50 ranked second, closely followed by the eBayes. The SAMCV was the last. At nominal FDR 0.05, the FCPC and eBayes controlled FDR at 0.040 and 0.048 and with a power of 0.433 and 0.141, respectively. The relative power gain of the FCPC over the eBayes was thus 323%. Given the small sample size, the empirical estimate of FDR in SAMCV appears to be unreasonable ( Table 2 ). In some cases, the empirical estimates unacceptably differed from the corresponding FDRs.  3.3 The representativeness of the first PC The representativeness of the first PC for each tight cluster was evaluated by ? in Section 2.3. Table 3 shows the distribution and certain mathematical characteristics of the ? -values of 427 806 tight clusters produced by 1000 simulated 5000×8 datasets from the clumpy mean–variance model described in Section 3.1. There were 329 978 clusters at tightness ?0.8, and 55 367 clusters at tightness 0.7 to 0.8 ( Table 3 ). The number of clusters decreased rapidly as the level of tightness declined. At each tightness level, the median and mean were large, and the coefficient of variance was very small. In general, the first PC of a tight cluster represented the cluster fairly well. On average, the first PC explained greater than 87% of the total variance ( Table 3 , see the smallest mean and median). Additional details for first PCs of tightness ? 0.8 are shown in Fig. S2 . 
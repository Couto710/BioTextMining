Flexible competing risks regression modeling and goodness-of-fit In this paper we consider different approaches for estimation and assessment of covariate effects for the cumulative incidence curve in the competing risks model. The classic approach is to model all cause-specific hazards and then estimate the cumulative incidence curve based on these cause-specific hazards. Another recent approach is to directly model the cumulative incidence by a proportional model ( Fine and Gray, J Am Stat Assoc 94:496-509, 1999 ), and then obtain direct estimates of how covariates influences the cumulative incidence curve. We consider a simple and flexible class of regression models that is easy to fit and contains the Fine-Gray model as a special case. One advantage of this approach is that our regression modeling allows for non-proportional hazards. This leads to a new simple goodness-of-fit procedure for the proportional subdistribution hazards assumption that is very easy to use. The test is constructive in the sense that it shows exactly where non-proportionality is present. We illustrate our methods to a bone marrow transplant data from the Center for International Blood and Marrow Transplant Research (CIBMTR). Through this data example we demonstrate the use of the flexible regression models to analyze competing risks data when non-proportionality is present in the data.  1 Introduction For competing risks data one often wishes to estimate and model the cumulative incidence function (CIF), the marginal probability of failure for a specific cause. Traditionally, the standard approach has been to estimate and model the cause-specific hazards, ? k ( t ) for k = 1,…, K causes ( Fig. 1 ). The cumulative incidence curves and cause-specific hazard functions for all causes contain the same information represented in different ways, thus leading to a different understanding of the subject matter. Both quantities are generally of interest. For simplicity we restrict attention to the situation with just two different causes of “death”, cause 1 and cause 2. In the later bone marrow transplant example these are disease relapse and treatment related mortality (TRM, defined as death in remission), respectively. Let ? k ( t ; x ) be the hazard of the k th cause failure ( k = 1, 2) conditional on a set of covariates x . The cumulative incidence curve of cause 1 given by covariates x is defined as P 1 ( t ; x ) = P ( T ? t , ? = 1 | x ) = ? 0 t ? 1 ( s ; x ) exp [ ? ? 0 s ? { ? 1 ( u ; x ) + ? 2 ( u ; x ) } d u ] d s , where T is the time of “death” and ? indicates the cause of failure ? ? {1, 2}. One can thus estimate the cumulative incidence function by estimating all cause-specific hazards and plugging them into the above expression. When the cause-specific hazards depend on covariates the cause specific hazards, ? k ( t ; x ) must be modeled. Cheng et al. (1998) studied the estimation of cumulative incidence probabilities based on Cox’s regression model for both causes and Shen and Cheng (1999) considered a special additive risk model. Both models do not allow the covariates to have time-varying effects. Recently, Scheike and Zhang (2002 , 2003 proposed and studied a flexible Cox-Aalen model, ? k ( t ; x k , z k ) = { ? k T ( t ) x k } exp { ? k T z k } , k = 1 , 2 , where x x is the covariates with first element to be 1 for all subjects. Here, some covariates, x k have additive and time-varying effects and other covariates, Z k have constant multiplicative effects. Quite generally one can use the Aalen-Johansen product limit estimator to estimate the cumulative incidence curves ( Andersen et al. 1993 ). The product limit estimator and other estimators based on estimating the causespecific hazards are valid as long as, for example, the censoring time and the event time are independent given the covariates of interest. Modeling and prediction of survival probabilities and cumulative incidence curves must be based on well fitting model of the cause specific hazards. It is therefore crucial to carefully investigate the goodness-of-fit of a suggested model, and that the model is sufficiently flexible to reflect the important aspects of the data. Scheike and Zhang (2003) demonstrated by practical examples that when time-varying effects are present in the data, then, obviously, to give good predictions the applied models must be able to reflect this structure. Even though estimates of the cumulative incidence curve are relatively easy to obtain by the above procedure, one problem is that it is hard to summarize the effect of covariates on the cumulative incidence curve in a simple way. T ypically, the important covariate effects for the cause-specific hazards will influence the cumulative incidence curve significantly, but it is possible that an effect on the cause specific hazard for cause 1 is countered by an adverse effect on the overall survival, and then even though the covariate may be highly significant for all cause-specific hazards it may not affect the cumulative incidence curve for cause 1. Also, it is possible that some covariates influence the cumulative incidence function, but it may not be significantly associated with any of the cause-specific hazards. T herefore it is hard to identify covariates which predicts the cumulative incidence probability through modeling of the cause-specific hazards. Fine and Gray (1999) ( FG ) developed a regression method to directly model the cumulative incidence function by modeling ? k * ( t ; x ) = ? d log { 1 ? P k ( t ; x ) } / d t . This approach is based on earlier work by Gray (1988) and Pepe (1991) . FG proposed a Cox type regression model where ? 1 * ( t ; x ) = ? 10 * ( t ) exp { ? T x } . This leads to a model for the cumulative incidence curve on the form P 1 ( t ; x ) = 1 ? exp { ? ? 10 * ( t ) exp ( ? T x ) } , where ? 10 * ( t ) = ? 0 t ? 10 * ( u ) d u . FG used an inverse probability of censoring weighting technique to estimate ? and ? 10 * ( t ) , and studied the large sample properties. This approach is implemented in the cmprsk package for R developed by Robert Gray. In this framework it is easy to decide if covariates significantly affect the cumulative incidence curve for a specific cause of failure. Clearly the FG model may not fit the data well and we here consider models that can remedy this problem. We aim in particular at representing time-varying effects in the data that can not be covered by the Cox type model. We consider a class of general models, h { P 1 ( t ; x ) } = g { ? ( t ) , ? , x } , where h is a known link function, g is a known regression function, and ? ( t ) and ? are unknown regression functions and regression parameters, respectively ( Scheike et al. 2008 (SZG)). In this paper we focus on the two classes of flexible models: the semiparametric multiplicative model (1) cloglog { 1 ? P 1 ( t ; x , z ) } = ? ( t ) T x + ? T z and the semiparametric additive model (2) ? log { 1 ? P 1 ( t ; x , z ) } = ? ( t ) T x + ( ? T z ) t , where x is a ( p + 1)-dimensional covariate ( x = (1, x 1, …, x p )), and z is q -dimensional covariate. These flexible models allow covariates, x , to have time-varying effects and let the other covariates, z , have constant effects. For survival data ( K = 1), the semiparametric additive model (2) has been proposed and studied by Mckeague and Sasieni (1994) . When x = 1, the multiplicative model (1) reduces to the FG’s Cox type model and the additive model (2) reduces to the Lin and Ying’s (1994) special additive model, and additive model (2) reduces to the Aalen’s fully nonparametric additive model when z = 0 . For both models one of the aims of this paper is to suggest tests for the hypothesis that a specific covariate, x j has a constant effect over time. In the multiplicative setting this amounts to the hypothesis H 0: ? j ( t ) ? ? , and in the additive setting H 0: ? j ( t ) ? ? · t . This leads to a very useful goodness-of-fit test for model validation and it is implemented in the function comp.risk in the timereg package for R developed by the authors. The test is constructive in the sense that it shows exactly where non-proportionality is present in terms of the covariate effects by simply considering the estimates of ? j ( t ). The approach we advocate in this paper is to start out with a model where all effects initially have non-parametric effects, and then reduce model complexity by successive testing to find an appropriate semiparametric model that fit the data well. One advanage of this procedure is that the model reduction in each step is kept to a relatively low degrees of freedom. The paper is structured as follows. In Sect. 2 we review how one can estimate the parameters of the model and the asymptotic results that can be used for inference. Section 3 establishes how to estimate the cumulative incidence curves and how to make confidence bands. Section 4 presents some test procedures for model identification. Section 5 contains a worked example where all the methods are applied to data from the Center for International Blood and Marrow Transplant Research ( CIBMTR ). Finally, Sect. 6 contains a discussion. The detailed formula for the variance estimations are given in the Appendix A . Appendix B gives the relevant R code for the worked example.  2 Direct binomial estimation Let T i and C i be event time and right censoring time for the i th individual, respectively, and let ? i ? {1, 2} denote the failure type. Let N i ( t ) = ?( T i ? t, ? i = 1) be the counting process associated with cause 1 and define the indicator ? i = ?( T i ? C i ) that is one when the observation is uncensored. We observe n independent identically distributed ( i.i.d .) replications of ( T? i , ?? i , X i , Z i ) where T? i = min( T i , C i ), ?? i = ? i ? i , X i = (1, X i 1,…, X ip )T, and Z i = ( Z i 1,…, Z iq )T. We assume that ( T i , ? i ) are independent of C i given covariate ( X i , Z i ). We denote the censoring distribution as G c ( t | X i , Z i ) = P { C ? t | X i , Z i }. We consider data collected in the time period [0, ? ]. For right censored competing risks data, the counting process, N i ( t ), is observed only up to the censoring time for censored individuals. Now consider the inverse censoring weighted response ? iN i ( t )/ G c ( T i | X i , Z i ) that has the mean equal to the cumulative incidence function, since E { ? i N i ( t ) G c ( T i | X i , Z i ) } = E [ E { ? i N i ( t ) G c ( T i | X i , Z i ) | X i , Z i } ] = E { N i ( t ) | X i , Z i } E ( ? i | X i , Z i ) G c ( T i | X i , Z i ) = P 1 ( t ; X i , Z i ) . Both multiplicative model (1) and additive model (2) can be represented as a basic semiparametric model, h { P 1 ( t ; x , z ) } = { ? ( t ) T x + g ( ? , z , t ) } , where h is a known link function, x = (1, x 1,…, x p ) is a ( p + 1) × 1 vector, g is a known function which is differentiable with respect to ? , and z is a q × 1 vector. The proposed semiparametric model allows some effects to vary nonparametrically with time and other effects to have constant parametric effects. In practice the aim is to find a model that fits the data and is as simple as possible. We suggest to do this by backwards model selection based on a test for time-varying effects. To do this we start by showing how to estimate the parameters of the model. In practice the censoring distribution G c ( t ; x i , z i ) is unknown, but it can be estimated by a Kaplan-Meier estimator or by a predicted value for each individual based on a regression model to improve the efficiency (see Scheike et al. 2008 ). For simplicity, we use Kaplan-Meier estimator that we denote as ? i . To estimate the regression function ? ( t ) and regression parameter ? , we consider the score equations at time t for ? ( t ) and ? on the form (3) U ? ( t , ? ( t ) , ? ) = ? i D ? , i ( t , ? ( t ) , ? ) w i ( t ) ( ? i N i ( t ) G ^ c ( T i ) ? P 1 ( t ; x i , z i ) ) = D ? T ( t , ? ( t ) , ? ) W ( t ) { R ( t ) ? P 1 ( n ) ( t , ? ( t ) , ? ) } = 0 (4) U ? ( ? , ? ( ? ) , ? ) = ? i ? 0 ? D ? , i ( t , ? ( t ) , ? ) w i ( t ) ( ? i N i ( t ) G ^ c ( T i ) ? P 1 ( t , x i , z i ) ) d t = ? 0 ? D ? T ( t , ? ( t ) , ? ) W ( t ) { R ( t ) ? P 1 ( n ) ( t , ? ( t ) , ? ) } d t = 0 where P 1 ( n ) ( t , ? ( t ) , ? ) is the n × 1 vector of P 1( t, x i, z i ), R ( t ) is the n × 1 vector of adjusted responses (? iN i ( t ))/ ? c ( T i ), D ? ( t, ? ( t ), ? ) and D ? ( t, ? ( t ), ? ) are the n × ( p +1) and n × q matrixes with i th row of D ?,i ( t, ? ( t ), ? ) = ? P 1( t; x i, z i )/ ? ? ( t ) and D ? ,i ( t, ? ( t ), ? ) = ? P 1( t; x i, z i )/ ? ? at each fixed time point t , respectively, and W ( t ) = diag( w i ( t )) where w i ( t ) are possible weights. The weights may be used to improve the efficiency of the estimators. The weights should for example reflect the variance of the considered response, but in our case with the additional uncertainty from the censoring distribution and the semiparametric model the optimal weights have a very complicated form that we have not been able to derive, see Nadeau and Lawless (1998) for derivations of optimal weights in a related but simpler situation. To solve these score equations simultaneously we proceed by Taylor expanding P 1 ( n ) ( t , ? ( t ) , ? ) around the current value of the estimates ( ?? (k) ( t , ?? (k) ) to get P 1 ( n ) ( t , ? ( t ) , ? ? p P 1 ( n ) ( t , ? ^ ( k ) ( t ) , ? ^ ( k ) ) + D ? ( t , ? ^ ( k ) ( t ) , ? ^ ( k ) ) { ? ( t ) ? ? ^ ( k ) ( t ) } + D ? ( t , ? ^ ( k ) ( t ) , ? ^ ( k ) ) { ? ? ? ^ ( k ) } . Replace it into the score Eq. 3 and Eq. 4 , and denote D ? ( k ) ( t ) = D ? ( t , ? ^ ( k ) ( t ) , ? ^ ( k ) ) , D ? ( k ) ( t ) = D ? ( t , ? ^ ( k ) ( t ) , ? ^ ( k ) ) , P 1 ( k ) ( t ) = P 1 ( n ) ( t , ? ^ ( k ) ( t ) , ? ^ ( k ) ) , to get approximated score equations (5) D ? ( k ) ( t ) T W ( t ) [ R ( t ) ? P 1 ( k ) ( t ) ? D ? ( k ) ( t ) { ? ( t ) ? ? ^ ( k ) ( t ) } ? D ? ( k ) ( t ) { ? ? ? ^ ( k ) } ] = 0 (6) ? 0 ? D ? ( k ) ( t ) T W ( t ) [ R ( t ) ? P 1 ( k ) ( t ) ? D ? ( k ) ( t ) { ? ( t ) ? ? ^ ( k ) ( t ) } ? D ? ( k ) ( t ) { ? ? ? ^ ( k ) } ] d t = 0 Solving Eq. 5 for ? ( t ) and plug it into Eq. 6 , and then solving Eq. 6 , we get ( k + 1)th iterate step estimator for ? , (7) ? ^ ( k + 1 ) = ? ^ ( k ) + { C ? ( k ) } ? 1 B ? ( k ) where C ? ( k ) = ? 0 ? D ? ( k ) ( t ) T W ( t ) H ( k ) ( t ) D ? ( k ) ( t ) dt B ? ( k ) = ? 0 ? D ? ( k ) ( t ) T W ( t ) H ( k ) ( t ) { R ( t ) ? P 1 ( k ) ( t ) } dt H ( k ) ( t ) = I ? D ? ( k ) ( t ) { ? ? ( k ) ( t ) } ? 1 D ? ( k ) ( t ) T W ( t ) ? ? ( k ) ( t ) = D ? ( k ) ( t ) T W ( t ) D ? ( k ) ( t ) . Plug the current estimator ?? (k+1) into (5), to get the ( k +1)th iterate estimator for ? ( t ) (8) ? ^ ( k + 1 ) ( t ) = ? ^ ( k ) ( t ) + { ? ? ( k ) ( t ) } ? 1 { D ? ( k ) ( t ) } T W ( t ) { R ( t ) ? P 1 ( k ) ( t ) ? D ? ( k ) { C ? ( k ) } ? 1 B ? ( k ) } The estimates of ? ( t ) will be piecewise constant functions that change their value only after Cause 1 events. The proposed method is closely related to the work by Koul et al. (1981) who did standard regression analysis for right censored survival times by using the modified response ? T / G c ( T ). Solving these score equations can be accomplished by standard software for GLM-models, that also lead to standard errors that are conservative ( Scheike et al. 2008 ). Under regularity conditions it can be shown that n ( ? ^ ? ? ) is asymptotically Gaussian with an asymptotic variance that can be estimated by ? ^ ? = n C ^ ? ? 1 [ ? i { W ^ 1 i ( ? ) } ? 2 ] C ^ ? ? 1 , where a ?2 = aa T for a column vector a, ? ? is evaluated at ( ??, ?? ) and explicit expression for ? 1 i ( ? ) is given in the Appendix A . Similarly it can be shown that n { ? ^ ( t ) ? ? ( t ) } is asymptotically Gaussian and has the same limit distributions as n { ? ^ ? ( t ) } ? 1 ? i W ^ 2 i ( t ) G i , where ( G 1,…, G n ) are i.i.d. standard normals ( Scheike et al. 2008 ) and an expression for ? 2 i can be found in the Appendix A . It follows that the variance of n { ? ^ ( t ) ? ? ( t ) } can be estimated by ? ^ ? ( t ) = n { ? ^ ? ( t ) } ? 1 [ ? i { W ^ 2 i ( t ) } ? 2 ] { ? ^ ? ( t ) } ? 1 and that a (1 - ? ) × 100% confidence band for ?? ( t ) over a fixed time interval can be constructed using resampling techniques. It is similar to the method of constructing the confidence band for the predicted cumulative incidence function (see details in the following section).  3 The cumulative incidence function It is important to estimate the predicted cumulative incidence function for a given set of covariates, ( x, z ). We estimate it by P ^ 1 ( t ; x , z ) = h ? 1 { x T ? ^ ( t ) + g ( ? ^ , z , t ) } . where h ?1 is inverse of the link function. Let d? ?1 ( t; x , z ) be the derivative of h ?1 and evaluated at ( t, x, z, ?? ( t ), ?? ). By the functional delta method it can be shown that the asymptotic distribution of n { P 1 ^ ( t ; x , z ) ? P 1 ( t ; x , z ) } has the same limit as B ^ P 1 ( t ; x , z ) = n [ d h ^ ? 1 ( t ; x , z ) ] ? W ^ 3 i ( t ; x , z ) G i where ( G 1,…, G n ) are standard normals and W ^ 3 i ( t ; x , z ) = x T { ? ^ ? ( t ) } ? 1 W ^ 2 i ( t ) + { ? g ( ? , z , t ) / ? ? } T { C ^ ? } ? 1 W ^ 1 i ( ? ) . It therefore follows that n { P 1 ^ ( t ; x , z ) ? P 1 ( t ; x , z ) } converges towards a Gaussian process with a variance that can be estimated by ? ^ P 1 2 ( t ; x , z ) = n [ d h ^ ? 1 ( t ; x , z ) } ] 2 ? i { W ^ 3 i ( t ; x , z ) } 2 . To construct the confidence band for P 1( t; x, z ), t ? [ t 1, t 2], we simulate L realizations of B? P 1( t ; x , z )/ ?? P 1( t ; x , z ), denoted as B ^ P 1 ( l ) ( t ; x , z ) / ? ^ P 1 ( t ; x , z ) , for l = 1,…, L . A (1 - ?) 100% confidence band for P 1( t; x ,z ) over the interval [ t 1, t 2] is given by P 1 ( t ; x , z ) ± C ? ? ^ P 1 ( t ; x , z ) , where C ? is the (1 - ? ) 100 th percentile of the sample sup t ? [ t 1 , t 2 ] | B ^ P 1 ( l ) ( t ; x , z ) / ? ^ P 1 ( t ; x , z ) | for l = 1,…, L .  4 Tests for model identification The direct modeling of the cumulative incidence function has received a lot attention recently and has proven itself a very useful tool to learn about the effects of covariates in the competing risks setting. The models we have considered in the previous contain nonparametric effects as well as parametric effects, P 1 ( t ; x , z ) = h ? 1 { x T ? ( t ) + g ( ? , z , t ) } . The significant effect for z j, j = 1,…, q , can be examined by testing H 0: ? j = 0 with the test statistic of ? ^ j / ? ^ ? j which has a standard Normal distribution asymptotically, where ? ^ ? j is the square root of the j th diagonal element of ?? ? . To see whether a coefficient, ? j ( t ) is significant ( H 0: ? j ( t ) = 0, t ? [0, ?]), we consider the test statistic T 1 j = sup t ? [ 0 , ? ] | ? ^ j ( t ) ? ^ ? j ( t ) | , where ? ^ ? j ( t ) is the j th diagonal element of ?? ? ( t ). The percentile of the observed test statistic can be computed by the resampling technique since under the null n { ? ^ j ( t ) } has same asymptotic distribution as n ? i [ { ? ^ ? ( t ) } ? 1 W ^ 2 i ( t ) G i ] j where ( G 1,…, G n ) are iid standard normals. To check if the coefficient, ? j ( t ) is significantly time-varying, we consider to test H 0: ? j ( t ) = h 1( ?? j, t ) t ? [0, ?], where ?? j is a constant and h 1 is specific know function. Under the multiplicative model h 1( ?? j, t ) = ?? j , and under the additive model h 1 ?? j, t ) = ?? jt . Under the multiplicative model, the constant effect can be estimated by ? ~ j = ? ? 1 ? 0 ? ? ^ j ( t ) d t , and similarly under the additive model. We use the test statistic T 2 j = sup t ? [ 0 , ? ] | ? ^ j ( t ) ? ? ~ j | , for the multiplicative model. Under the null hypothesis, n { ? ^ j ( t ) ? ? ~ j } is asymptotically equivalent to the distribution of n ? i [ { ? ^ ? ( t ) } ? 1 { W ^ 2 i ( t ) ? 1 ? ? 0 ? W ^ 2 i ( s ) d s } G i ] j where ( G 1,…, G n ) are iid standard normals. Similarly, the percentile of the observed test statistic can be computed by resampling technique. The additive model has a similar iid decomposition that can be used for resampling. In practice, we may first fit a general fully nonparametric model P 1 ( t ; x ) = h ? 1 { x T ? ( t ) } , where x contains all covariates, and plot the estimated regression coefficient functions with its (1 - ?) 100% confidence intervals/bands. Visually inspecting these plots and combine the test results given by T 1 and T 2 will lead to a reasonable well fitted semi-parametric regression model. These model identification procedures will be applied in the real data examples given in the next section. Some goodness-of-fit test procedures have been proposed to identify the best fitted model between semiparametric multiplicative model (1) and semiparametric additive model (2) ( Mckeague and Utikal 1990 ). These non-nested tests can be extended to our current setting. In this study, we considered that these two classes of models are flexible and it should fit the data well.  5 Worked example We consider a transplant outcome data set from The Center for International Blood and Marrow Transplant Research (CIBMTR). The CIBMTR is comprised of clinical and basic scientists who confidentially share data on their blood and bone marrow transplant patients with CIBMTR Data Collection Center located at the Medical College of Wisconsin. The CIBMTR is a repository of information about results of transplants at more than 450 transplant centers worldwide. The data used in this paper consists of 1,537 adult patients (age > 18 years old) who received a HLA-identical sibling transplant from 1994 to 2004 for acute myelogenous leukemia (AML) or acute lymphoblastic leukemia (ALL) and transplanted in first complete remission. All patients received bone marrow transplantation or peripheral blood stem cell transplantation. Two competing risks are treatment related mortality (TRM, defined as death in remission) and disease relapse. The variables considered in this example are age ( AGEM : continuous variable and centered at mean value of 38 years), disease type ( ALL : 1 for ALL (28%) vs. 0 for AML (72%)), time from diagnosis ( DX ) to first complete remission ( CR1 ) ( DXCR1GT45D : 1 for > 45 days (45%) vs. 0 for ? 45 days (55%)), Karnfosky performance score ( KARLE80 : 1 for 0–80 (22%) vs. 0 for 90–100 (78%)), donor-patient gender match ( FM : 1 for female to male (24%) vs. 0 for otherwise (76%)), and donor graft type ( PB : 1 for peripheral blood stem cell (50%) vs. 0 for bone marrow (50%)). First, we consider the cause-specific hazard approach. For TRM , we fit the data to a regular Cox model and test the proportionality by adding a time-dependent covariate, ?10( t )exp{ ? 1 Z 1 + ? 2 Z 1 × log( t )}. The test indicates that the donor-patient gender match ( P = 0.0238) and the donor graft type ( P < 0.0001) have a time-varying effect, and the other four covariates are all significant with P < 0.05. For relapse, all covariates have a constant effect and only the disease type ( P < 0.0001) and time from DX to CR1 ( P = 0.0443) are significant based on cause-specific hazard regression modeling approach. Since the cumulative incidence function (CIF) of each cause of failure is a function of both cause-specific hazards of TRM and relapse, we are not be able to clearly see which covariate that has a time-varying effect and which covariate that has a significant effect directly on the CIF of TRM and relapse. We now directly model the CIF of TRM. To use the direct modeling approach we need to estimate the unknown censoring distribution. Based on Cox regression model, we find that the censoring distribution does depend on the covariates of disease type, Karnofsky performance score and donor graft type. We therefore estimated the inverse probability censoring weights for each individual using a Cox model. It turns out however, that for this data, there is no big difference compared to using the simple Kaplan-Meier weights. To illustrate the basic principles suggested, we start by considering the fully non-parametric multiplicative model (1) and additive model (2). First, we fit a multiplicative model with all time-varying effects, the estimated regression functions, ? j ( t ) with 95% pointwise confidence intervals are given in Fig. 2 . It shows that all six covariates have a constant effect on TRM which leads to a different conclusion compare to the result based on the cause-specific hazard approach. This is confirmed by testing the time-varying effect of each component H 0 : ? j ( t ) ? ? j using T 2 j (see Table 1 ). Five hundred resampling processes are used to compute the P -value of the supremum test. Successive testing showed that the CIF was adequately modelled by the model where all covariates have constant effects, that is the FG Cox type model. The estimates of the FG model for TRM are given in Table 1 . We see that patient age and donor-patient sex match have strong effects, disease type, time from diagnosis to 1st CR and Kar-nofsky performance have only mild effects, and donor graft type has a marginal effect ( P = 0.0602). The estimate ?? indicates an increase in TRM incidence rate. For example, ?? (ALL) = 0.646 shows that patient with ALL disease has a higher incidence of TRM than AML patients. Next, we fit an additive model with all time-varying effects, the estimated regression functions, ? j ( t ) with 95% pointwise confidence intervals are given in Fig. 3 . It seems that patient age has a mild time-varying effect. Age appears to have a stronger effect the first 40 months since transplantation and no effect thereafter. To see if this finding is significant we considered the formal test for test for time-varying effect and this showed that age was adequately modelled by a constant effect. Successive testing of time-varying effects using the a series of semiparametric additive model for each variable using T 2 j (see Table 2 ), shows that all six covariates are well approximated by constant effects. We therefore fit a parametric additive model (see Table 2 ) which gives a similar conclusion to the multiplicative model. To physicians and patients, it is important to get an idea about the cumulative incidence probability for a specific patient. We therefore compute the predicted CIF for a given set value of covariates. For the illustration purpose, we consider two group of patients: a Case 1 patient with good prognostic factors (AML patient, time from diagnosis to CR1 is less than 45 days, Karnofsky performance score of 90–100, donor-patient gender match of other than female to male, donor graft type of BM, and age of 25 years old) and a Case 2 patient with poor prognostic factors (ALL patient, time from diagnosis to CR1 is longer than 45 days, Karnofsky performance score of 0–80, donor-patient gender match of female to male, and donor graft type of PB, and age of 45 years old). Figure 3 indicated that age may have a mild time-varying effect. To accommodate such potential time-varying effect, we also considered a flexible semi-parametric additive model where AGEM is included in the nonparametric part of the model (denoted as “Additive Model 2” in Fig. 4 ). Figure 4 shows the predicted CIF of TRM with 95% confidence intervals as well as 95% confidence bands for a case 1 patient and a case 2 patient based on a parametric multiplicative model, a parametric additive model (denoted as “Additive Model 1”) and the additive model with flexible age effects (“Additive Model 2”). We note that the predictions are quite similar based on these three models, exactly as we would expect since all models were validated. We now consider the cumulative incidence function for relapse. We start by considering a nonparametric multiplicative model where all covariates have a time-varying effect, we found that the disease type ( P < 0.0001) has a strong time-varying effect (see Fig. 5 ). The successive testing lead to a model with flexible time-varying modeling of disease type and with all other covariates having constant effects (see Table 3 ). Similarly, successive testing for the additive model resulted in a model with disease type having a strong time-varying effect ( P < 0.0001) and karnofsky score having a mild time-varying effect ( P = 0.022) (see Table 4 ). This consistent with the regression coefficient plot of ?? j ( t ) for the karnofsky score ( Fig. 5 ) that shows an initial large effect and is followed by an adverse effect (comparing the slopes of the estimates early and late on the timescale). For simplicity and due to the relatively weak time-varying effect, we finally fit a semiparametric model for relapse where only the disease type having a time-varying effect (see Table 4 ). We further validated that the predictions for these two models were quite similar. We again estimate the CIF of relapse for Cases 1 and 2 patients. To accommodate the time-varying effect of disease type, we estimated the CIF of relapse based on the flexible multiplicative model (“Multiplicative REL”) and the flexible additive model (“Additive REL”) that we validated above (see Fig. 6 ). Both flexible models give similar predictions. We estimated the CIF of relapse for a simple FG model (“FG REL”) for comparison and the difference between the predictions are not dramatic in this example with the relatively low CIF. For this example the multiplicative and the additive model provide quite similar predictions when the models are flexible and allowed some covariates to have a time-varying effect. It is also noteworthy that the models may have different time-varying effects (see Fig. 2 and Fig. 3 ), which of-course is a consequence of the different link-functions. It is generally quite difficult to say which link function should be preferred, but in our experience the additive link function has the best numerical and small sample performance and is therefore to be preferred.  6 Discussion We have illustrated how flexible models for the cumulative incidence may be used to obtain a more detailed understanding of the phenomenon in question. When the flexibility of the non-parametric effects are needed it may lead to quite different predictions for the cumulative incidence functions for the different causes. For the BMT data we saw that the FG model was able to describe the cumulative incidence for treatment related mortality but not for the risk of relapse. The lacking flexibility of the FG model was found using the goodness-of-fit approach that showed that the non-proportionality primarily can be attributed to the effects of the disease type. A similar conclusion was reached for the additive model. Both models lead to quite similar predictions, and we showed how to obtain the confidence bands for the nonparametric regression coefficients and predicted cumulative incidence functions.  6 Discussion We have illustrated how flexible models for the cumulative incidence may be used to obtain a more detailed understanding of the phenomenon in question. When the flexibility of the non-parametric effects are needed it may lead to quite different predictions for the cumulative incidence functions for the different causes. For the BMT data we saw that the FG model was able to describe the cumulative incidence for treatment related mortality but not for the risk of relapse. The lacking flexibility of the FG model was found using the goodness-of-fit approach that showed that the non-proportionality primarily can be attributed to the effects of the disease type. A similar conclusion was reached for the additive model. Both models lead to quite similar predictions, and we showed how to obtain the confidence bands for the nonparametric regression coefficients and predicted cumulative incidence functions.  Figures and Tables Fig. 1 Figure illustrating the competing risks model Fig. 2 Estimates of nonparametric effects with 95% confidence intervals for TRM based on a multiplicative model Fig. 3 Estimates of nonparametric effects with 95% confidence intervals for TRM based on an additive model Fig. 4 Predicted cumulative incidence functionof TRM with 95% confidence intervals and 95% confidence bands for the two groups of patients based on three models: parametric multiplicative model; parametric additive model (“additive model 1”); and semiparametric additive model (“additive model 2”) Fig. 5 Estimates of nonparametric effects with 95% confidence intervals for relapse based on multiplicative and additive model Fig. 6 Predicted cumulative incidence function of relapse with 95% confidence intervals and 95% confidence bands for the two groups of patients based on multiplicative; additive model; and FG model Table 1 Fitting nonparametric and parametric multiplicative model for TRM Variable Nonparametric models Parametric model Test of constant effect ?? (SE; P ) AGEM 0.648 0.0269 (0.0046; <0.0001) ALL 0.646 0.2920 (0.1190; 0.0139) DXCR1GT45D 0.990 0.2120 (0.1060; 0.0454) KARLE80 0.784 0.2980 (0.1200; 0.0133) FM 0.088 0.3640 (0.1150; 0.0015) PB 0.312 0.0578 (0.1110; 0.0602) Table 2 Fitting nonparametric and parametric additive model for TRM Variable Nonparametric models Parametric model Test of constant effect ?? (SE; P ) AGEM 0.140 0.0001 (0.00002; <0.0001) ALL 0.256 0.0012 (0.0006; 0.0311) DXCR1GT45D 0.548 0.0011 (0.0005; 0.0194) KARLE80 0.856 0.0012 (0.0007; 0.0619) FM 0.092 0.0015 (0.0006; 0.0129) PB 0.630 0.0004 (0.0005; 0.4240) Table 3 Fitting nonparametric and semiparametric multiplicative model for relapse Variable Nonparametric models Semiarametric model Test of constant effect ?? (SE; P ) AGEM 0.248 0.0009 (0.0069; 0.9000) ALL <0.001 - DXCR1GT45D 0.264 0.2710 (0.1660; 0.1030) KARLE80 0.578 0.3510 (0.1830; 0.0550) FM 0.378 ?0.3040 (0.2040; 0.1360) PB 0.230 0.3110 (0.1700; 0.0668) Table 4 Fitting nonparametric and semiparametric additive model for relapse Variable Nonparametric models Semiparametric model Test of constant effect ?? (SE; P ) AGEM 0.236 0.000007(0.000012; 0.5700) ALL <0.001 - DXCR1GT45D 0.608 0.00052 (0.00028; 0.0645) KARLE80 0.022 0.00025 (0.00043; 0.4390) FM 0.302 ?0.00032 (0.00030; 0.2880) PB 0.084 0.00027 (0.00027; 0.3290)  Figures and Tables Fig. 1 Figure illustrating the competing risks model Fig. 2 Estimates of nonparametric effects with 95% confidence intervals for TRM based on a multiplicative model Fig. 3 Estimates of nonparametric effects with 95% confidence intervals for TRM based on an additive model Fig. 4 Predicted cumulative incidence functionof TRM with 95% confidence intervals and 95% confidence bands for the two groups of patients based on three models: parametric multiplicative model; parametric additive model (“additive model 1”); and semiparametric additive model (“additive model 2”) Fig. 5 Estimates of nonparametric effects with 95% confidence intervals for relapse based on multiplicative and additive model Fig. 6 Predicted cumulative incidence function of relapse with 95% confidence intervals and 95% confidence bands for the two groups of patients based on multiplicative; additive model; and FG model Table 1 Fitting nonparametric and parametric multiplicative model for TRM Variable Nonparametric models Parametric model Test of constant effect ?? (SE; P ) AGEM 0.648 0.0269 (0.0046; <0.0001) ALL 0.646 0.2920 (0.1190; 0.0139) DXCR1GT45D 0.990 0.2120 (0.1060; 0.0454) KARLE80 0.784 0.2980 (0.1200; 0.0133) FM 0.088 0.3640 (0.1150; 0.0015) PB 0.312 0.0578 (0.1110; 0.0602) Table 2 Fitting nonparametric and parametric additive model for TRM Variable Nonparametric models Parametric model Test of constant effect ?? (SE; P ) AGEM 0.140 0.0001 (0.00002; <0.0001) ALL 0.256 0.0012 (0.0006; 0.0311) DXCR1GT45D 0.548 0.0011 (0.0005; 0.0194) KARLE80 0.856 0.0012 (0.0007; 0.0619) FM 0.092 0.0015 (0.0006; 0.0129) PB 0.630 0.0004 (0.0005; 0.4240) Table 3 Fitting nonparametric and semiparametric multiplicative model for relapse Variable Nonparametric models Semiarametric model Test of constant effect ?? (SE; P ) AGEM 0.248 0.0009 (0.0069; 0.9000) ALL <0.001 - DXCR1GT45D 0.264 0.2710 (0.1660; 0.1030) KARLE80 0.578 0.3510 (0.1830; 0.0550) FM 0.378 ?0.3040 (0.2040; 0.1360) PB 0.230 0.3110 (0.1700; 0.0668) Table 4 Fitting nonparametric and semiparametric additive model for relapse Variable Nonparametric models Semiparametric model Test of constant effect ?? (SE; P ) AGEM 0.236 0.000007(0.000012; 0.5700) ALL <0.001 - DXCR1GT45D 0.608 0.00052 (0.00028; 0.0645) KARLE80 0.022 0.00025 (0.00043; 0.4390) FM 0.302 ?0.00032 (0.00030; 0.2880) PB 0.084 0.00027 (0.00027; 0.3290) 
Automatic Segmentation of Cell Nuclei in Bladder and Skin Tissue for Karyometric Analysis Objective To automatically segment cell nuclei in histology images of bladder and skin tissue for karyometric analysis. Study Design The four main steps in the program were as follows: median filtering and thresholding, segmentation, categorizing, and cusp correction. This robust segmentation technique used properties of the image histogram to optimally select a threshold and create closed four-way chain code nuclear segmentations. Each cell nucleus segmentation was treated as an individual object whose properties of segmentation quality were used for criteria to classify each nucleus as: throw away, salvageable, or good. An erosion/dilation procedure and re-thresholding were performed on salvageable nuclei to correct cusps. Results Ten bladder histology images were segmented both by hand and using this automatic segmentation algorithm. The automatic segmentation resulted in a sensitivity of 76.4%, defined as the percentage of hand segmented nuclei that were automatically segmented with good quality. The median proportional difference between hand and automatic segmentations over 42 nuclei each with 95 features used in karyometric analysis was 1.6%. The same procedure was performed on 10 skin histology images with a sensitivity of 83.0% and median proportional difference of 2.6%. Conclusion The close agreement in karyometric features with hand segmentation shows that automated segmentation can be used for analysis of bladder and skin histology images.  INTRODUCTION In the United States in 2007, bladder cancer is expected to be the 4th most common type of newly reported cancer in men 1 . The most common form of bladder cancer is urothelial carcinoma, which refers to a tumor in the lining of the bladder. In the United States, 90% of bladder cancers are urothelial carcinoma. The recurrence rate for bladder cancer is 80%, and patients who have papillary urothelial neoplasms of low malignant potential (PUNLMP) lesions are at an increased risk of recurrence. It is not possible to identify which PUNLMP cases will recur based on histopathological diagnosis 2 . Recent studies have shown that the evaluation of the nuclear chromatin organization state by karyometry is useful in predicting recurrence of superficial urothelial carcinoma 3 , 4 . Non-melanoma skin cancers (squamous cell carcinoma and basal cell carcinoma) are the most frequently diagnosed malignancies in the United States, accounting for approximately 40% of all cancer diagnoses and an estimated one million new cases in 2007. Squamous cell carcinoma (SCC) accounts for about 20% of the non-melanoma skin cancers, but it is clinically significant because of its ability to metastasize 5 . A continuum has been observed from normal skin to sun damage, to actinic keratosis (AK), ending with SCC. Karyometry can be used to evaluate this continuum as a guide for disease progression 6 , 7 . Karyometry is a digital texture analysis-based method of evaluating cell nuclei images in histology. It provides a degree of sensitivity greater than the human eye, and can detect small differences amidst high biological variability. Karyometry can objectively quantify the progression of cancer along a progression curve, from normal to cancerous tissue. These advantages, coupled with low cost, make karyometry a powerful analytic tool. The computerized extraction of karyometric features provides 95 features descriptive of the spatial and statistical distribution pattern of the nuclear chromatin based on transition frequencies, run lengths, and numerous other characteristics of pixel grey values. 8 The most time consuming portion of karyometric analysis is nuclear segmentation. Automated segmentation remains a challenge because of the unequaled complexity of histological images of cells. 9 A variety of interactive and fully automated methods have been studied. When the reproducibility and accuracy of an interactive thresholding-based method, manual tracing with a stylus, and arc- and ellipse-fitting routines were compared, it was found that the interactive arc fitting routine was the most accurate and reproducible. 10 Interactive algorithms generally produce reliable segmentation results but require user participation. Automatic segmentation algorithms have been based on region growing or splitting 11 , histogram thresholding 12 , 13 , edges 14 , or clusters. 15 Automatic segmentation can be improved by a priori knowledge of the cell and background properties. Wu et al. showed promising results by assuming ideally elliptical shaped cell boundaries 16 and smooth cell boundaries 17 . Since karyometry is used to evaluate a broad range of cell nuclei from normal to cancerous, it is necessary to develop a robust automated segmentation program that does not make any assumptions about the shape of cell boundary in order to avoid biasing cell nuclei statistics with the segmentation shape. The current method in our laboratory for segmenting cell nuclei for karyometric analysis uses a semi-automated procedure with manual correction. The user must input a threshold grayscale level that the program uses to threshold the image and create closed four-way chain codes for pixels darker than the threshold value. If the nuclei the user wishes to select are not segmented well with this threshold, the user can either enter another threshold or manually correct the segmentation boundary. Since in this application the same threshold is applied across the entire image, the user generally needs to manually correct at least 50% of the segmentations in a bladder histology image and 80% of the segmentations in a skin histology image. Thousands of nuclear segmentations are required for karyometric analysis, making the segmentation process the most time consuming portion of karyometric analysis. This paper describes a novel fully automated method of segmenting cell nuclei in bladder and skin histology images in which each cell nucleus is treated as an individual object with properties that describe its segmentation quality. The goal of this automated segmentation program is to segment all the cell nuclei in an image so that the user can select as many as possible for karyometric analysis.  MATERIALS AND METHODS This original research was approved by the University of Arizona Institutional Review Board. Image Acquisition Ten 640 × 472 pixel, 8-bit bladder histology images were used to evaluate the quality of this automatic segmentation method for use in histology images of bladder tissue. These images were acquired as part of a study on using chromatin phenotype karyometry to predict recurrence in papillary urothelial neoplasms of low malignant potential (PUNLMP) 18 . Similarly, ten 1280 × 960 pixel 8-bit skin histology images were used to evaluate the quality of the automatic segmentation method in histology images of skin tissue. These images were acquired as part of a study documenting specific histopathologies that are quantitatively associated with the progression from normal skin to AK to SCC or normal skin to dysplastic nevi. Bladder and skin histology images were stained with hematoxylin and eosin (H&E). Bladder sections were recorded on a video microscope equipped with a 63:1 Zeiss (Zeiss, Oberkochen, Germany) planapochromatic oil immersion objective, N.A. 1.40, and a COHU (San Diego, CA, USA) black and white video camera. Skin sections were recorded on a video microscope equipped with a 100:1 Zeiss planapochromatic oil immersion objective, N.A. 1.40, and a DXC9000, 3-CCD color camera. An interference filter with a maximum bandpass at 610 nm was used to enhance contrast of the H&E stained bladder and skin sections. The relay optics provided a sampling density of 6 pixels/um. Hand Segmentation In order to quantify individual nuclei, each nucleus must be segmented from the general image. This segmentation was previously done using an interactive program that required a user to input a grayscale level threshold. Throughout this paper, segmentation performed in this manner will be referred to as hand segmentation. After the user selected a threshold that appeared optimal, the program generated closed four-way chain code segmentations for pixels darker than the threshold. The user manually adjusted the boundary of the nuclei of interest until the segmentation was adequate for karyometric analysis. The user was directed by a pathologist to choose nuclei from particular regions of interest (e.g., stroma vs. glandular nuclei) appropriate to the study. The user then randomly chose a number of nuclei from these regions, usually 100 or 200, according to the statistical design of the study. The user was also trained in recognizing which nuclei were appropriate for sampling. To prevent users from unconsciously biasing the study through preferential selection of normal-appearing nuclei, training emphasized rejection of nuclei only for technical reasons, such as nuclei artifactually damaged during sectioning, overlapping nuclei, and nuclei that lay outside the plane of focus. The automatic program was designed to segment all nuclei in the image field and allow the user to perform selection of nuclei for karyometric analysis according to these principles. Automatic Segmentation The four main steps in the program were as follows: median filtering and thresholding, segmentation, categorizing, and cusp correction. This robust segmentation technique used properties of the image histogram to optimally select a threshold and create closed four-way chain code nuclear segmentations. Each cell nucleus segmentation was treated as an individual object with properties of segmentation quality. A segmentation was placed in one of the following three categories based on its properties: throw away, salvageable, or good. An erosion/dilation procedure and rethresholding were performed on salvageable nuclei to correct cusps. Median Filtering and Thresholding The original image was median filtered with a 5×5 pixel kernel to reduce pixel noise. The threshold was then automatically selected based on the median filtered image histogram. The histogram optical density (OD) levels were multiplied by 100, and therefore ranged from 0 (white) to 255 (black). Typically in bladder histology images 2 peaks were seen, the first peak representing the non-nuclear tissue, and the second peak representing cell nuclei. The optimal threshold was found to be the optical density at the valley between these two peaks. If multiple peaks occurred in the processed image histogram, the peak closest to 255 usually contained pixels corresponding to the cell nuclei. Therefore, the grayscale level at the largest-valued valley was chosen as the threshold. In skin histology images the histogram rarely displayed 2 peaks, instead generally appearing single-peaked or many-peaked with no distinct valleys. If no distinct valleys occurred in the processed image histogram of either bladder or skin histology images, the threshold was chosen with the assumption that cell nuclei covered the darkest 20% of the pixels in the image. Segmentation Closed four-way chain code nuclear segmentations were created for pixels in the image darker than the threshold. The directions used were Up, Right, Down, and Left, numbered with 1, 2, 3 and 4, respectively. A smoothed difference chain code was created by taking the difference between neighboring chain code elements and sequentially applying running average filters with a length of 10 and 5. A cusp was signified by a zero crossing in the smoothed difference chain code. The mean and standard deviation of the pixel area were calculated for the group of segmented nuclei in each image. Each segmentation was treated as an individual object, and the following properties were calculated and recorded for each object: 1. pixel area 2. flag if object pixel area was more than 1 standard deviation away from the group pixel area 3. best fit ellipse determined by segmentation angle, area moment, and circumference 4. cusp locations given by zero crossings in the smoothed difference chain code 5. ratio of chain code length to segmentation area 6. ratio of ellipse circumference to chain code length Properties 1–6 were used to evaluate the quality of the segmentation. The following additional properties were calculated for each object but were not found to be useful in evaluating segmentation quality. 7. mean and standard deviation of pixel intensity 8. spottiness – determined by run length encoding Categorizing Objects were placed in one of three categories based on their properties: throw away, salvageable, or good. Any object with an area smaller than the group mean by more than one standard deviation was thrown away since it was likely background tissue. An object was placed in the salvageable category based on properties 4–6, which are measures of wavy or unsmooth segmentation. All other objects were assumed to be adequately segmented for karyometric analysis and were placed in the good segmentation category. A ratio of good objects to total objects found was calculated. The described algorithm was repeated with a test threshold equal to the original threshold and varied up to 2 grayscale levels in each direction. The test threshold that produced the highest ratio was saved as the optimal threshold, and the corresponding segmented image was used in the following procedure. Cusp Correction An erosion/dilation procedure was performed on “salvageable” objects that had a mean pixel area larger than the group mean pixel area by more than three standard deviations. These objects were usually multiple nuclei lying in close proximity that had been segmented as a single nucleus. Properties of all resulting objects were evaluated and statistically analyzed. After optimal thresholding, any “salvageable” objects with cusps were rethresholded using a cropped area around the segmentation from the median filtered image. This enabled the program to find an optimal localized threshold, since cell nuclear intensity may vary throughout the image. The optimal threshold was varied up to 15 grayscale levels in each direction or until an object without cusps was found. The object with the fewest number of cusps replaced the original object. If no objects were found with fewer cusps than the original object the original object was kept. The properties of any new objects were evaluated and statistically analyzed. A training set of bladder and skin histology images was used for the development of the fully automatic segmentation program. The training set contained different images than the images in the test set used in the statistical analysis. Statistical Analysis Statistical analysis was performed on ten bladder histology images and ten skin histology images to compare the karyometric features calculated from hand segmentation to those generated from this fully automatic segmentation program. Five patients contributed 2 bladder histology images each, or 10 bladder histology images in total. In these 10 bladder histology images, 55 nuclei were randomly selected from the intermediate and basal layers and hand segmented. Similarly, 5 patients contributed 2 skin histology images each, or 10 skin histology images in total. In these 10 skin histology images, 53 nuclei were randomly chosen from the basal and sub-basal layers and hand segmented. Ninety-five karyometric features descriptive of the spatial and statistical distribution of the nuclear chromatin were computed for each nucleus, as defined and detailed in the Appendix . Proportional differences between the 95 karyometric features in the hand segmentations and the automatic segmentations were calculated using 42 good nuclear segmentations from bladder histology images and 44 good nuclear segmentations from skin histology images.  Image Acquisition Ten 640 × 472 pixel, 8-bit bladder histology images were used to evaluate the quality of this automatic segmentation method for use in histology images of bladder tissue. These images were acquired as part of a study on using chromatin phenotype karyometry to predict recurrence in papillary urothelial neoplasms of low malignant potential (PUNLMP) 18 . Similarly, ten 1280 × 960 pixel 8-bit skin histology images were used to evaluate the quality of the automatic segmentation method in histology images of skin tissue. These images were acquired as part of a study documenting specific histopathologies that are quantitatively associated with the progression from normal skin to AK to SCC or normal skin to dysplastic nevi. Bladder and skin histology images were stained with hematoxylin and eosin (H&E). Bladder sections were recorded on a video microscope equipped with a 63:1 Zeiss (Zeiss, Oberkochen, Germany) planapochromatic oil immersion objective, N.A. 1.40, and a COHU (San Diego, CA, USA) black and white video camera. Skin sections were recorded on a video microscope equipped with a 100:1 Zeiss planapochromatic oil immersion objective, N.A. 1.40, and a DXC9000, 3-CCD color camera. An interference filter with a maximum bandpass at 610 nm was used to enhance contrast of the H&E stained bladder and skin sections. The relay optics provided a sampling density of 6 pixels/um.  Hand Segmentation In order to quantify individual nuclei, each nucleus must be segmented from the general image. This segmentation was previously done using an interactive program that required a user to input a grayscale level threshold. Throughout this paper, segmentation performed in this manner will be referred to as hand segmentation. After the user selected a threshold that appeared optimal, the program generated closed four-way chain code segmentations for pixels darker than the threshold. The user manually adjusted the boundary of the nuclei of interest until the segmentation was adequate for karyometric analysis. The user was directed by a pathologist to choose nuclei from particular regions of interest (e.g., stroma vs. glandular nuclei) appropriate to the study. The user then randomly chose a number of nuclei from these regions, usually 100 or 200, according to the statistical design of the study. The user was also trained in recognizing which nuclei were appropriate for sampling. To prevent users from unconsciously biasing the study through preferential selection of normal-appearing nuclei, training emphasized rejection of nuclei only for technical reasons, such as nuclei artifactually damaged during sectioning, overlapping nuclei, and nuclei that lay outside the plane of focus. The automatic program was designed to segment all nuclei in the image field and allow the user to perform selection of nuclei for karyometric analysis according to these principles.  Automatic Segmentation The four main steps in the program were as follows: median filtering and thresholding, segmentation, categorizing, and cusp correction. This robust segmentation technique used properties of the image histogram to optimally select a threshold and create closed four-way chain code nuclear segmentations. Each cell nucleus segmentation was treated as an individual object with properties of segmentation quality. A segmentation was placed in one of the following three categories based on its properties: throw away, salvageable, or good. An erosion/dilation procedure and rethresholding were performed on salvageable nuclei to correct cusps.  Median Filtering and Thresholding The original image was median filtered with a 5×5 pixel kernel to reduce pixel noise. The threshold was then automatically selected based on the median filtered image histogram. The histogram optical density (OD) levels were multiplied by 100, and therefore ranged from 0 (white) to 255 (black). Typically in bladder histology images 2 peaks were seen, the first peak representing the non-nuclear tissue, and the second peak representing cell nuclei. The optimal threshold was found to be the optical density at the valley between these two peaks. If multiple peaks occurred in the processed image histogram, the peak closest to 255 usually contained pixels corresponding to the cell nuclei. Therefore, the grayscale level at the largest-valued valley was chosen as the threshold. In skin histology images the histogram rarely displayed 2 peaks, instead generally appearing single-peaked or many-peaked with no distinct valleys. If no distinct valleys occurred in the processed image histogram of either bladder or skin histology images, the threshold was chosen with the assumption that cell nuclei covered the darkest 20% of the pixels in the image.  Segmentation Closed four-way chain code nuclear segmentations were created for pixels in the image darker than the threshold. The directions used were Up, Right, Down, and Left, numbered with 1, 2, 3 and 4, respectively. A smoothed difference chain code was created by taking the difference between neighboring chain code elements and sequentially applying running average filters with a length of 10 and 5. A cusp was signified by a zero crossing in the smoothed difference chain code. The mean and standard deviation of the pixel area were calculated for the group of segmented nuclei in each image. Each segmentation was treated as an individual object, and the following properties were calculated and recorded for each object: 1. pixel area 2. flag if object pixel area was more than 1 standard deviation away from the group pixel area 3. best fit ellipse determined by segmentation angle, area moment, and circumference 4. cusp locations given by zero crossings in the smoothed difference chain code 5. ratio of chain code length to segmentation area 6. ratio of ellipse circumference to chain code length Properties 1–6 were used to evaluate the quality of the segmentation. The following additional properties were calculated for each object but were not found to be useful in evaluating segmentation quality. 7. mean and standard deviation of pixel intensity 8. spottiness – determined by run length encoding  Categorizing Objects were placed in one of three categories based on their properties: throw away, salvageable, or good. Any object with an area smaller than the group mean by more than one standard deviation was thrown away since it was likely background tissue. An object was placed in the salvageable category based on properties 4–6, which are measures of wavy or unsmooth segmentation. All other objects were assumed to be adequately segmented for karyometric analysis and were placed in the good segmentation category. A ratio of good objects to total objects found was calculated. The described algorithm was repeated with a test threshold equal to the original threshold and varied up to 2 grayscale levels in each direction. The test threshold that produced the highest ratio was saved as the optimal threshold, and the corresponding segmented image was used in the following procedure.  Cusp Correction An erosion/dilation procedure was performed on “salvageable” objects that had a mean pixel area larger than the group mean pixel area by more than three standard deviations. These objects were usually multiple nuclei lying in close proximity that had been segmented as a single nucleus. Properties of all resulting objects were evaluated and statistically analyzed. After optimal thresholding, any “salvageable” objects with cusps were rethresholded using a cropped area around the segmentation from the median filtered image. This enabled the program to find an optimal localized threshold, since cell nuclear intensity may vary throughout the image. The optimal threshold was varied up to 15 grayscale levels in each direction or until an object without cusps was found. The object with the fewest number of cusps replaced the original object. If no objects were found with fewer cusps than the original object the original object was kept. The properties of any new objects were evaluated and statistically analyzed. A training set of bladder and skin histology images was used for the development of the fully automatic segmentation program. The training set contained different images than the images in the test set used in the statistical analysis.  Statistical Analysis Statistical analysis was performed on ten bladder histology images and ten skin histology images to compare the karyometric features calculated from hand segmentation to those generated from this fully automatic segmentation program. Five patients contributed 2 bladder histology images each, or 10 bladder histology images in total. In these 10 bladder histology images, 55 nuclei were randomly selected from the intermediate and basal layers and hand segmented. Similarly, 5 patients contributed 2 skin histology images each, or 10 skin histology images in total. In these 10 skin histology images, 53 nuclei were randomly chosen from the basal and sub-basal layers and hand segmented. Ninety-five karyometric features descriptive of the spatial and statistical distribution of the nuclear chromatin were computed for each nucleus, as defined and detailed in the Appendix . Proportional differences between the 95 karyometric features in the hand segmentations and the automatic segmentations were calculated using 42 good nuclear segmentations from bladder histology images and 44 good nuclear segmentations from skin histology images.  RESULTS Bladder Histology Images A typical bladder histology image segmentation is shown in Figure 1 . Since the histogram displayed 2 peaks, generally corresponding to non-nuclei tissue and nuclei tissue, with a distinct valley between them, the threshold was set as the pixel intensity at the valley. The image characteristics and therefore the image histogram depend strongly on processing of the biopsy and stain uptake, and therefore did not always exhibit 2 peaks. Nuclei in images from one patient appeared very light ( Figure 2 ) and the corresponding histogram only displayed 1 peak. The automatic segmentation program in this case did not segment the image as well because the default threshold was set to segment the darkest 20% of the image and the image had reduced contrast. These results highlight the need for controlled histological processing in karyometric analysis, particularly when automatic segmentation methods are used. Out of the 55 hand segmented nuclei in the 10 bladder histology images, the automatic segmentation resulted in 4 missed nuclei due to the threshold set too low, 9 salvageable segmentations, and 42 good segmentations. This resulted in a sensitivity of 76.4%, defined as the proportion of successful automated segmentation out of all hand segmented nuclei, or 42/55. It is important to note that in images where automatic program missed nuclei or produced a salvageable segmentation out of the selected hand segmentations, a sufficient number of good segmentations were available for the user to select. The 95 karyometric features were averaged over the 42 good segmentations. Features that were 0 across all segmentations were not used in comparing the hand and automatic segmentation of bladder and skin tissue. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 48.3%, with a median of 1.6%. A 1.7% proportional difference in nuclear area and a 1.5% proportional difference in total optical density, two key karyometric features, were found. Figure 3 shows a hand (left) and automatic (right) segmentation for a bladder cell nucleus, with a 4.1% proportional difference in nuclear area, a 2.2% proportional difference in total optical density, and a median proportional difference of 3.1% over all non-zero karyometric features. In many instances it was visually apparent that the automatic segmentation chose a higher threshold than the interactive program operator, therefore forming a tighter chain code around the nucleus and segmenting darker pixels. The largest proportional difference, 48.3%, was seen from a feature that describes the number of transitions that occur from the smallest optical density thresholded to the largest optical density thresholded within the segmentation. This feature along with other karyometric features that are calculated using pixels in the edges of cell nuclei displayed the largest proportional difference between the hand and automatic segmentations. Although the hand segmentations are considered to be the gold standard, the human eye has a limited resolution and therefore the hand segmentations do contain error. As noted above, there were instances where the proportional difference in nuclear features between hand and automated segmentations may well have stemmed from the automated process performing better, not worse, than the hand process. Moreover, since karyometric features are compared across different tissue classes (e.g. normal vs. cancer), consistency in segmentation is crucial for efficient and unbiased comparisons, and the automated procedure better provides this consistency. Skin Histology Images The histogram of skin histology images displayed 2 peaks less frequently. A typical segmented skin histology image is shown in Figure 4 . The default threshold (segmenting the darkest 20% of the image) segmented this image well, perhaps due to the high image contrast. Out of the 53 hand segmented nuclei in the 10 skin histology images, automatic segmentation resulted in 0 missed nuclei due to the threshold being set too low, 9 salvageable segmentations, and 44 good segmentations which resulted in a sensitivity of 83%. Similar to bladder histology images, the automatic program produced a sufficient number of additional good segmentations that were available for the user to select. The 95 karyometric features were averaged over the 44 good segmentations. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 200%, with a median of 2.6%. The largest proportional difference was seen in a feature that describes the run length of small optical density values. A 2.7% proportional difference in nuclear area and a 2.1% proportional difference in optical density were found. Figure 5 shows a hand (left) and automatic segmentation (right) for a skin cell nucleus, with a 1.3% proportional difference in nuclear area, a 1.1% proportional difference in optical density, and a median proportional difference of 2.9% over all non-zero karyometric features.  RESULTS Bladder Histology Images A typical bladder histology image segmentation is shown in Figure 1 . Since the histogram displayed 2 peaks, generally corresponding to non-nuclei tissue and nuclei tissue, with a distinct valley between them, the threshold was set as the pixel intensity at the valley. The image characteristics and therefore the image histogram depend strongly on processing of the biopsy and stain uptake, and therefore did not always exhibit 2 peaks. Nuclei in images from one patient appeared very light ( Figure 2 ) and the corresponding histogram only displayed 1 peak. The automatic segmentation program in this case did not segment the image as well because the default threshold was set to segment the darkest 20% of the image and the image had reduced contrast. These results highlight the need for controlled histological processing in karyometric analysis, particularly when automatic segmentation methods are used. Out of the 55 hand segmented nuclei in the 10 bladder histology images, the automatic segmentation resulted in 4 missed nuclei due to the threshold set too low, 9 salvageable segmentations, and 42 good segmentations. This resulted in a sensitivity of 76.4%, defined as the proportion of successful automated segmentation out of all hand segmented nuclei, or 42/55. It is important to note that in images where automatic program missed nuclei or produced a salvageable segmentation out of the selected hand segmentations, a sufficient number of good segmentations were available for the user to select. The 95 karyometric features were averaged over the 42 good segmentations. Features that were 0 across all segmentations were not used in comparing the hand and automatic segmentation of bladder and skin tissue. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 48.3%, with a median of 1.6%. A 1.7% proportional difference in nuclear area and a 1.5% proportional difference in total optical density, two key karyometric features, were found. Figure 3 shows a hand (left) and automatic (right) segmentation for a bladder cell nucleus, with a 4.1% proportional difference in nuclear area, a 2.2% proportional difference in total optical density, and a median proportional difference of 3.1% over all non-zero karyometric features. In many instances it was visually apparent that the automatic segmentation chose a higher threshold than the interactive program operator, therefore forming a tighter chain code around the nucleus and segmenting darker pixels. The largest proportional difference, 48.3%, was seen from a feature that describes the number of transitions that occur from the smallest optical density thresholded to the largest optical density thresholded within the segmentation. This feature along with other karyometric features that are calculated using pixels in the edges of cell nuclei displayed the largest proportional difference between the hand and automatic segmentations. Although the hand segmentations are considered to be the gold standard, the human eye has a limited resolution and therefore the hand segmentations do contain error. As noted above, there were instances where the proportional difference in nuclear features between hand and automated segmentations may well have stemmed from the automated process performing better, not worse, than the hand process. Moreover, since karyometric features are compared across different tissue classes (e.g. normal vs. cancer), consistency in segmentation is crucial for efficient and unbiased comparisons, and the automated procedure better provides this consistency. Skin Histology Images The histogram of skin histology images displayed 2 peaks less frequently. A typical segmented skin histology image is shown in Figure 4 . The default threshold (segmenting the darkest 20% of the image) segmented this image well, perhaps due to the high image contrast. Out of the 53 hand segmented nuclei in the 10 skin histology images, automatic segmentation resulted in 0 missed nuclei due to the threshold being set too low, 9 salvageable segmentations, and 44 good segmentations which resulted in a sensitivity of 83%. Similar to bladder histology images, the automatic program produced a sufficient number of additional good segmentations that were available for the user to select. The 95 karyometric features were averaged over the 44 good segmentations. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 200%, with a median of 2.6%. The largest proportional difference was seen in a feature that describes the run length of small optical density values. A 2.7% proportional difference in nuclear area and a 2.1% proportional difference in optical density were found. Figure 5 shows a hand (left) and automatic segmentation (right) for a skin cell nucleus, with a 1.3% proportional difference in nuclear area, a 1.1% proportional difference in optical density, and a median proportional difference of 2.9% over all non-zero karyometric features.  Bladder Histology Images A typical bladder histology image segmentation is shown in Figure 1 . Since the histogram displayed 2 peaks, generally corresponding to non-nuclei tissue and nuclei tissue, with a distinct valley between them, the threshold was set as the pixel intensity at the valley. The image characteristics and therefore the image histogram depend strongly on processing of the biopsy and stain uptake, and therefore did not always exhibit 2 peaks. Nuclei in images from one patient appeared very light ( Figure 2 ) and the corresponding histogram only displayed 1 peak. The automatic segmentation program in this case did not segment the image as well because the default threshold was set to segment the darkest 20% of the image and the image had reduced contrast. These results highlight the need for controlled histological processing in karyometric analysis, particularly when automatic segmentation methods are used. Out of the 55 hand segmented nuclei in the 10 bladder histology images, the automatic segmentation resulted in 4 missed nuclei due to the threshold set too low, 9 salvageable segmentations, and 42 good segmentations. This resulted in a sensitivity of 76.4%, defined as the proportion of successful automated segmentation out of all hand segmented nuclei, or 42/55. It is important to note that in images where automatic program missed nuclei or produced a salvageable segmentation out of the selected hand segmentations, a sufficient number of good segmentations were available for the user to select. The 95 karyometric features were averaged over the 42 good segmentations. Features that were 0 across all segmentations were not used in comparing the hand and automatic segmentation of bladder and skin tissue. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 48.3%, with a median of 1.6%. A 1.7% proportional difference in nuclear area and a 1.5% proportional difference in total optical density, two key karyometric features, were found. Figure 3 shows a hand (left) and automatic (right) segmentation for a bladder cell nucleus, with a 4.1% proportional difference in nuclear area, a 2.2% proportional difference in total optical density, and a median proportional difference of 3.1% over all non-zero karyometric features. In many instances it was visually apparent that the automatic segmentation chose a higher threshold than the interactive program operator, therefore forming a tighter chain code around the nucleus and segmenting darker pixels. The largest proportional difference, 48.3%, was seen from a feature that describes the number of transitions that occur from the smallest optical density thresholded to the largest optical density thresholded within the segmentation. This feature along with other karyometric features that are calculated using pixels in the edges of cell nuclei displayed the largest proportional difference between the hand and automatic segmentations. Although the hand segmentations are considered to be the gold standard, the human eye has a limited resolution and therefore the hand segmentations do contain error. As noted above, there were instances where the proportional difference in nuclear features between hand and automated segmentations may well have stemmed from the automated process performing better, not worse, than the hand process. Moreover, since karyometric features are compared across different tissue classes (e.g. normal vs. cancer), consistency in segmentation is crucial for efficient and unbiased comparisons, and the automated procedure better provides this consistency. Skin Histology Images The histogram of skin histology images displayed 2 peaks less frequently. A typical segmented skin histology image is shown in Figure 4 . The default threshold (segmenting the darkest 20% of the image) segmented this image well, perhaps due to the high image contrast. Out of the 53 hand segmented nuclei in the 10 skin histology images, automatic segmentation resulted in 0 missed nuclei due to the threshold being set too low, 9 salvageable segmentations, and 44 good segmentations which resulted in a sensitivity of 83%. Similar to bladder histology images, the automatic program produced a sufficient number of additional good segmentations that were available for the user to select. The 95 karyometric features were averaged over the 44 good segmentations. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 200%, with a median of 2.6%. The largest proportional difference was seen in a feature that describes the run length of small optical density values. A 2.7% proportional difference in nuclear area and a 2.1% proportional difference in optical density were found. Figure 5 shows a hand (left) and automatic segmentation (right) for a skin cell nucleus, with a 1.3% proportional difference in nuclear area, a 1.1% proportional difference in optical density, and a median proportional difference of 2.9% over all non-zero karyometric features.  Bladder Histology Images A typical bladder histology image segmentation is shown in Figure 1 . Since the histogram displayed 2 peaks, generally corresponding to non-nuclei tissue and nuclei tissue, with a distinct valley between them, the threshold was set as the pixel intensity at the valley. The image characteristics and therefore the image histogram depend strongly on processing of the biopsy and stain uptake, and therefore did not always exhibit 2 peaks. Nuclei in images from one patient appeared very light ( Figure 2 ) and the corresponding histogram only displayed 1 peak. The automatic segmentation program in this case did not segment the image as well because the default threshold was set to segment the darkest 20% of the image and the image had reduced contrast. These results highlight the need for controlled histological processing in karyometric analysis, particularly when automatic segmentation methods are used. Out of the 55 hand segmented nuclei in the 10 bladder histology images, the automatic segmentation resulted in 4 missed nuclei due to the threshold set too low, 9 salvageable segmentations, and 42 good segmentations. This resulted in a sensitivity of 76.4%, defined as the proportion of successful automated segmentation out of all hand segmented nuclei, or 42/55. It is important to note that in images where automatic program missed nuclei or produced a salvageable segmentation out of the selected hand segmentations, a sufficient number of good segmentations were available for the user to select. The 95 karyometric features were averaged over the 42 good segmentations. Features that were 0 across all segmentations were not used in comparing the hand and automatic segmentation of bladder and skin tissue. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 48.3%, with a median of 1.6%. A 1.7% proportional difference in nuclear area and a 1.5% proportional difference in total optical density, two key karyometric features, were found. Figure 3 shows a hand (left) and automatic (right) segmentation for a bladder cell nucleus, with a 4.1% proportional difference in nuclear area, a 2.2% proportional difference in total optical density, and a median proportional difference of 3.1% over all non-zero karyometric features. In many instances it was visually apparent that the automatic segmentation chose a higher threshold than the interactive program operator, therefore forming a tighter chain code around the nucleus and segmenting darker pixels. The largest proportional difference, 48.3%, was seen from a feature that describes the number of transitions that occur from the smallest optical density thresholded to the largest optical density thresholded within the segmentation. This feature along with other karyometric features that are calculated using pixels in the edges of cell nuclei displayed the largest proportional difference between the hand and automatic segmentations. Although the hand segmentations are considered to be the gold standard, the human eye has a limited resolution and therefore the hand segmentations do contain error. As noted above, there were instances where the proportional difference in nuclear features between hand and automated segmentations may well have stemmed from the automated process performing better, not worse, than the hand process. Moreover, since karyometric features are compared across different tissue classes (e.g. normal vs. cancer), consistency in segmentation is crucial for efficient and unbiased comparisons, and the automated procedure better provides this consistency. Skin Histology Images The histogram of skin histology images displayed 2 peaks less frequently. A typical segmented skin histology image is shown in Figure 4 . The default threshold (segmenting the darkest 20% of the image) segmented this image well, perhaps due to the high image contrast. Out of the 53 hand segmented nuclei in the 10 skin histology images, automatic segmentation resulted in 0 missed nuclei due to the threshold being set too low, 9 salvageable segmentations, and 44 good segmentations which resulted in a sensitivity of 83%. Similar to bladder histology images, the automatic program produced a sufficient number of additional good segmentations that were available for the user to select. The 95 karyometric features were averaged over the 44 good segmentations. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 200%, with a median of 2.6%. The largest proportional difference was seen in a feature that describes the run length of small optical density values. A 2.7% proportional difference in nuclear area and a 2.1% proportional difference in optical density were found. Figure 5 shows a hand (left) and automatic segmentation (right) for a skin cell nucleus, with a 1.3% proportional difference in nuclear area, a 1.1% proportional difference in optical density, and a median proportional difference of 2.9% over all non-zero karyometric features.  Skin Histology Images The histogram of skin histology images displayed 2 peaks less frequently. A typical segmented skin histology image is shown in Figure 4 . The default threshold (segmenting the darkest 20% of the image) segmented this image well, perhaps due to the high image contrast. Out of the 53 hand segmented nuclei in the 10 skin histology images, automatic segmentation resulted in 0 missed nuclei due to the threshold being set too low, 9 salvageable segmentations, and 44 good segmentations which resulted in a sensitivity of 83%. Similar to bladder histology images, the automatic program produced a sufficient number of additional good segmentations that were available for the user to select. The 95 karyometric features were averaged over the 44 good segmentations. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 200%, with a median of 2.6%. The largest proportional difference was seen in a feature that describes the run length of small optical density values. A 2.7% proportional difference in nuclear area and a 2.1% proportional difference in optical density were found. Figure 5 shows a hand (left) and automatic segmentation (right) for a skin cell nucleus, with a 1.3% proportional difference in nuclear area, a 1.1% proportional difference in optical density, and a median proportional difference of 2.9% over all non-zero karyometric features.  Skin Histology Images The histogram of skin histology images displayed 2 peaks less frequently. A typical segmented skin histology image is shown in Figure 4 . The default threshold (segmenting the darkest 20% of the image) segmented this image well, perhaps due to the high image contrast. Out of the 53 hand segmented nuclei in the 10 skin histology images, automatic segmentation resulted in 0 missed nuclei due to the threshold being set too low, 9 salvageable segmentations, and 44 good segmentations which resulted in a sensitivity of 83%. Similar to bladder histology images, the automatic program produced a sufficient number of additional good segmentations that were available for the user to select. The 95 karyometric features were averaged over the 44 good segmentations. The proportional difference between the hand and automatic segmentations for the non-zero averaged karyometric features ranged from 0 to 200%, with a median of 2.6%. The largest proportional difference was seen in a feature that describes the run length of small optical density values. A 2.7% proportional difference in nuclear area and a 2.1% proportional difference in optical density were found. Figure 5 shows a hand (left) and automatic segmentation (right) for a skin cell nucleus, with a 1.3% proportional difference in nuclear area, a 1.1% proportional difference in optical density, and a median proportional difference of 2.9% over all non-zero karyometric features.  DISCUSSION The close agreement in karyometric features show that the automated segmentation can be used for karyometric analysis of bladder and skin tissue. Future work includes improving the program so that it may be used on a broader range of tissue types. The program will be augmented with better criteria to determine when adjacent nuclei are segmented as a single nucleus. One method may be to look at a single segmentation with multiple cusps, and verify whether the cusps are located opposite to each other. Another method may use an ellipse model with second moments matching the segmentation. The program may also be improved by combining thresholding with edge detection. Creating a closed chain code with a threshold is easier than using edge detection alone. However, once a closed chain code is created, comparing the chain code boundary with edges found using an edge detection method may prove useful. These improvements to the automatic segmentation program would enable it to perform well on a broad range of tissue types.  DISCUSSION The close agreement in karyometric features show that the automated segmentation can be used for karyometric analysis of bladder and skin tissue. Future work includes improving the program so that it may be used on a broader range of tissue types. The program will be augmented with better criteria to determine when adjacent nuclei are segmented as a single nucleus. One method may be to look at a single segmentation with multiple cusps, and verify whether the cusps are located opposite to each other. Another method may use an ellipse model with second moments matching the segmentation. The program may also be improved by combining thresholding with edge detection. Creating a closed chain code with a threshold is easier than using edge detection alone. However, once a closed chain code is created, comparing the chain code boundary with edges found using an edge detection method may prove useful. These improvements to the automatic segmentation program would enable it to perform well on a broad range of tissue types.  Figures Figure 1 A typical bladder histology image segmentation. Image histogram displayed two peaks and the threshold was set as the pixel intensity at the valley. Figure 2 Segmented bladder histology image with a lighter stain compared to Figure 1 . Image histogram displayed one peak and the threshold was set to segment the darkest 20% of the image. Figure 3 Shows a typical hand (left) and automatic (right) segmentation for a bladder cell nucleus, with a 4.1% proportional difference in nuclear area, a 2.2% proportional difference in optical density, and a median proportional difference of 3.1% over all non-zero karyometric features. Figure 4 A typical segmented skin histology image with the threshold set to segment the darkest 20% of the image. Figure 5 Shows a hand (left) and automatic segmentation (right) for a skin cell nucleus, with a 1.3% proportional difference in nuclear area, a 1.1% proportional difference in optical density, and a median proportional difference of 2.9% over all non-zero karyometric features.  Figures Figure 1 A typical bladder histology image segmentation. Image histogram displayed two peaks and the threshold was set as the pixel intensity at the valley. Figure 2 Segmented bladder histology image with a lighter stain compared to Figure 1 . Image histogram displayed one peak and the threshold was set to segment the darkest 20% of the image. Figure 3 Shows a typical hand (left) and automatic (right) segmentation for a bladder cell nucleus, with a 4.1% proportional difference in nuclear area, a 2.2% proportional difference in optical density, and a median proportional difference of 3.1% over all non-zero karyometric features. Figure 4 A typical segmented skin histology image with the threshold set to segment the darkest 20% of the image. Figure 5 Shows a hand (left) and automatic segmentation (right) for a skin cell nucleus, with a 1.3% proportional difference in nuclear area, a 1.1% proportional difference in optical density, and a median proportional difference of 2.9% over all non-zero karyometric features. 
Evaluation of targeting errors in ultrasound-assisted radiotherapy A method for validating the start-to-end accuracy of a 3D ultrasound-based patient positioning system for radiotherapy is described. A radiosensitive polymer gel is used to record the actual dose delivered to a rigid phantom after being positioned using 3D ultrasound guidance. Comparison of the delivered dose with the treatment plan allows accuracy of the entire radiotherapy treatment process, from simulation to 3D ultrasound guidance, and finally delivery of radiation, to be evaluated. The 3D ultrasound patient positioning system has a number of features for achieving high accuracy and reducing operator dependence. These include using tracked 3D ultrasound scans of the target anatomy acquired using a dedicated 3D ultrasound probe during both the simulation and treatment sessions, automatic 3D ultrasound-to-ultrasound registration, and use of infra-red LED (IRED) markers of the optical position sensing system for registering simulation CT to ultrasound data. The mean target localization accuracy of this system was 2.5 mm for four target locations inside the phantom, compared to 1.6 mm obtained using the conventional patient positioning method of laser alignment. Since the phantom is rigid, this represents the best possible set-up accuracy of the system. Thus, these results suggest that 3D ultrasound-based target localization is practically feasible and potentially capable of increasing the accuracy of patient positioning for radiotherapy in sites where day-to-day organ shifts are greater than 1 mm in magnitude.  Introduction The aim of radiotherapy is to deliver a lethal dose of radiation to the tumor while minimizing the exposure of surrounding healthy tissues to radiation. With the advent of conformal treatment techniques such as intensity-modulated radiation therapy (IMRT), 3D dose distributions that accurately match the shape of the target volume can now be achieved, facilitating increases in radiation dose to tumor sites and reductions in treatment margins. However, errors in patient positioning at the time of treatment can still cause geometric miss of the target volume and irradiation of greater amounts of healthy tissue ( Langen and Jones, 2001 ). Thus, image-guidance methods for localizing the target inside the treatment room have become the subject of considerable research efforts ( Herman, 2005 ; van Herk et al, 2004 ; Jaffray, 2005 ; Mackie et al, 2003 ; Langen et al, 2005 ). Ultrasound imaging has a number of desirable features which make its use in radiotherapy applications appealing. These include being relatively inexpensive, non-harmful to the patient, being able to visualize soft tissue, and acquire 3D volumetric representations of the anatomy. Indeed, a number of commercial systems, including the BAT (Nomos, Chatsworth, CA), SonArray (Varian, Palo Alto, CA), and Restitu (Resonant Medical, Montreal, Canada), which use ultrasound to verify the position of the tumor prior to the commencement of daily treatment, are now in clinical use ( Lattanzi et al, 1999 ; Meeks et al, 2003 ; Cury et al, 2004 ). In addition, techniques for integrating B-mode ultrasound information in radiation treatment planning have been investigated ( Wein et al, 2007 ). Although substantial improvements in patient positioning accuracy have been reported for ultrasound-based target localization systems, no attempts to characterize their overall start-to-end accuracy have previously been reported in the literature. Tomé et al (2002) evaluated the accuracy of the SonArray ultrasound patient positioning system using an array of passive infra-red markers of the Polaris optical sensor (NDI, Waterloo, Canada) attached to a phantom. Locations of targets within the phantom as measured by CT in the treatment room were then compared to ultrasound measured target locations. Drever and Hilts (2007) described a phantom for quality assurance (QA) of the calibration accuracy between treatment room lasers and ultrasound coordinates for the Restitu system. In this paper, a method is presented for evaluating the complete start-to-end accuracy of an ultrasound patient positioning system. Due to the additional coordinate transformations and calibrations required when adding ultrasound-assisted positioning, a small addition to the overall error can be expected compared to the current established method of aligning skin markers placed on the patient with room lasers. The goal of this study is to characterize the magnitude of this error under ideal conditions for a new 3D ultrasound-based scheme for target localization. Unlike previous studies which measure a subset of errors in the patient positioning process ( Tomé et al, 2002 ; Drever and Hilts, 2007 ), the sources of error at all steps are taken into account herein by measuring explicitly where the radiation was delivered in a dose-sensitive phantom, and compared to the planned target location. This novel validation approach allows the loop to be closed on the entire treatment process. Since this phantom is rigid, a lower bound on the target localization error for the system can be established and compared with expected interfractional organ motion to evaluate whether ultrasound guidance is beneficial. In addition, ultrasound positioning results are compared with using room lasers alone and optical tracking as gold standards.  System Description The ultrasound guidance method used in this study is most similar to the Restitu system, as intra-modality ultrasound-to-ultrasound registration is performed to compare the patient anatomy during treatment and CT simulation. In contrast to the BAT and SonArray systems, which attempt to perform CT-to-ultrasound registration based on image content, intra-modality registration is a more tractable problem, and does not su er from the variable appearance of anatomical features in CT and ultrasound ( Narayana et al, 1997 ; Hoffelt et al, 2003 ). The tradeo is the need to perform an additional ultrasound scan at the time of CT simulation. In addition, to minimize reliance on operator input, and hence reduce inter-operator variability which can significantly affect existing systems ( Langen et al, 2003 ), automatic pixel-intensity based image registration is used. Unlike existing systems, which all use freehand ultrasound ( Rohling et al, 1999 ) to acquire 3D patient data, a dedicated 3D probe is utilized for this study. These offer a number of advantages, including minimizing the number of image acquisitions needed to obtain a 3D perspective of the anatomy (one cf . multiple 2D images), ease of use (removes the need to manually sweep a 2D probe), and potentially improved accuracy in the reconstructed 3D image ( Treece et al, 2002 ). The 3D ultrasound patient positioning system consists of the GE Voluson 730 Expert ultrasound machine (GE Healthcare, Waukesha, WI) interfaced with the OPTOTRAK 3020 position sensor (NDI, Waterloo, Canada). The convex array RAB4-8P transducer was used to acquire ultrasound data. This transducer has an internal mechanism which can physically pivot the transducer elements, allowing an entire series of 2D image slices in a fan-like pattern to be acquired while the probe remains stationary. This equipment is used for both the ‘simulation’ session, where a CT scan of the patient is taken to facilitate treatment planning, and the ‘treatment’ session, where radiation is delivered according to the plan. During the simulation procedure, infra-red LED (IRED) markers of the OPTOTRAK are placed on the patient’s skin before commencement of the CT scan so that they appear in the CT image as fiducial markers. Immediately after CT imaging, an ultrasound volume of the same anatomy at the treatment site is acquired. During ultrasound imaging, both the ultrasound probe and patient positions are tracked by the OPTOTRAK using IREDs attached to the probe and patient. After the simulation procedure, the IRED markers are removed from the patient. The acquired CT and ultrasound images are registered off-line using OPTOTRAK measurements and the IRED fiducial locations in CT. This key step enables treatment planning to proceed conventionally using CT data, while allowing the prescribed dose plan to be transferred to the ultrasound image to facilitate target localization during treatment by comparison of simulation and treatment ultrasound data. In the treatment session, the patient is set up as usual using skin marks and alignment lasers. Due to possible errors, such as internal day-to-day organ shifts with respect to the skin markers, the target may not be exactly at the expected location. Thus, another ultra-sound volume of the target anatomy is taken at approximately the same viewpoint as the simulation ultrasound, while the probe position inside the treatment room is measured by OPTOTRAK. Finally, this ultrasound is automatically rigidly registered to the ultrasound taken during simulation. This image registration step allows the location of the target, which is known relative to the simulation ultrasound, to be found inside the treatment room with respect to the linear accelerator (LINAC). The series of coordinate transformations that are used by the proposed system to localize the treatment target with respect to the LINAC are shown in Fig. 1 and summarized below: PatT CT : The CT to patient transformation. This is calculated using point-based registration utilizing corresponding IRED locations on the patient and in the CT scan ( Horn, 1987 ). OT Pat : The patient to OPTOTRAK transformation given by OPTOTRAK measured IRED locations on the patient. PT O : The OPTOTRAK to ultrasound probe transformation given by OPTOTRAK measured IRED locations on the probe. UT P : The ultrasound probe to ultrasound image transformation. This is constant for a given probe and can be pre-determined in an off-line calibration procedure ( Poon and Rohling, 2005 ). U?T U : The transformation between simulation and treatment ultrasound images of the target anatomy. This is to be calculated using an automatic image registration algorithm. P?T U? : The ultrasound image to probe transformation for the treatment session. If the same probe is used as during simulation, this is the inverse of UTP above. O?T P? : The ultrasound probe position inside the treatment room measured by the OPTOTRAK. LT O? : The OPTOTRAK to LINAC transformation. This can be determined by measuring alignment laser positions in the treatment room using the OPTOTRAK. The matrix T represents a 6 degree-of-freedom rigid-body coordinate transformation. Thus, in order to localize a target location CTx iso defined in the simulation CT coordinates with respect to the LINAC at the time of treatment, the following chain of coordinate transforms are used by our system: (1) X iso L = T O ? L T P O ? T U ? P ? T U U ? T P U T O P T Pat O T CT Pat X iso CT . In summary, the main differences between the target localization method used in this study and current existing systems, including the Restitu, are the use of dedicated 3D ultrasound probes for image acquisition, automatic pixel-intensity based rigid registration of simulation and treatment ultrasound images, and optical tracking of both patient and ultrasound probes during the simulation procedure.  Methods Two validation studies were performed to ascertain the accuracy of the proposed 3D ultra-sound positioning system. First, the accuracy of the method for registering simulation CT and ultrasound images (left panel of Fig. 1 ) was tested. This step is a key component of the target localization process as it allows transfer of the dose plan defined in CT to ultrasound after the simulation and treatment planning processes. Then, the entire system accuracy is evaluated, including errors at the time of dose delivery. An idealized, rigid phantom is used in both experiments to establish the lower bound accuracy of the system. Simulation CT and Ultrasound Registration Accuracy CT and ultrasound images of the phantom shown in Fig. 2 were registered using the series of transformations shown in the left panel of Fig. 1 . This phantom contains wire crosses to facilitate ultrasound probe calibration and speed of sound verification, and 8 IREDs attached outside as fiducial markers. It is filled with an ultrasound tissue equivalent material consisting of (by weight) 3% high gel strength agar (Sigma-Aldrich, St. Louis, MO), 88.4% distilled water (Anachemia, Montreal, Canada), and 8.6% n-propanol (Fisher Scientific, Hampton, NH) to regulate its acoustic velocity to 1540 ms ?1 ( Burlew et al, 1980 ). Embedded within the gel were 43 aluminum ball bearings (BBs) of 1 mm diameter to act as point features. These ball bearings were pushed into the gel with a needle just before it coalesced and were randomly distributed throughout the phantom. The speed of sound in the phantom was verified to be within 0.5% of 1540ms?1 by comparing the physical distance between the center of two vertical wire crosses with their observed distance in an ultrasound image. Therefore, geometric distortions in ultrasound images of the phantom due to speed of sound error are expected to be insignificant. The calibration matrix UT P of our ultrasound probe was determined using the methods described by Poon and Rohling (2005) . Briefly, the ‘IXI’ shaped wire crosses in the phantom were scanned while tracking both the probe and phantom positions with the OPTOTRAK. The resulting ultrasound image was rigidly registered to a virtual model of the wires generated using their locations with respect to the IRED markers on the phantom, which had been precisely measured during its construction. This registration step was performed using the Amira 3D visualization toolkit (TGS, San Diego, CA) by maximizing the image correlation coefficient ( Fitzpatrick and Sonka, 2000 ). The result of this registration ( UT Phan ), and the OPTOTRAK measurements of the phantom and probe positions ( PhanT O and PT O , respectively)were then used to calculate UT P : (2) T P U = T Phan U T O Phan ( T O P ) ? 1 CT imaging was performed at the British Columbia Cancer Agency (BCCA) with a PQ5000 CT simulator (Picker International, Cleveland, OH). On the same day, the phantom was imaged using 3D ultrasound, as shown in Fig. 2 . Nine ultrasound volumes were required in order to image the entire phantom. The required registration parameters OT Pat and PT O were measured using OPTOTRAK for each volume. The remaining unknown PatT CT was calculated by least-squares minimization of the distance between the measured IRED locations on the phantom and their corresponding locations in the CT scan ( Horn, 1987 ). IRED locations in CT were determined by finding their image centroid and applying a calibrated offset (1.47 mm ) along their axis of symmetry to account for the offset of the IRED inside its housing. The BB locations in CT were identified by calculating the image centroid in a surrounding region of interest, as shown in Fig. 3 . The BB locations in ultrasound were similarly identified after thresholding was used to remove the comet-tail artifact from ultrasound. Since the BB occupies many voxels in both the CT and ultrasound images, their target localization error (TLE) was considerably smaller than the dimension of a voxel (0.68 × 0.68 × 1.5 mm for CT, 0.55 mm for ultrasound ). The difference in corresponding BB locations in registered CT and ultrasound images was defined as the target registration error (TRE) and used to evaluate the accuracy of the registration. Since ultrasound data was acquired with a curvilinear array probe, for which beam width, line density and lateral resolution decreases below the image center, BB locations near the center of the volume were selected as target locations for comparison. Target Localization Accuracy of Entire System In order to determine the overall accuracy of the proposed system, the entire process of radiation therapy, from simulation, to 3D ultrasound guidance, and finally irradiation, was performed on the phantom shown in Fig. 4 . This phantom consists of a large box containing the same ultrasound tissue equivalent material as described previously ( Burlew et al, 1980 ) and 3 embedded balloons filled with the same material plus a high concentration of cellulose to act as hyperechogenic features in ultrasound. The lid of the box was opened to allow access by the ultrasound probe. Eight IREDs were taped to the side wall of the box as CT fiducials. In addition, four polypropylene NALGENE ® bottles containing a radiosensitive polymer gel were rigidly secured to the wooden base with cable ties. The polymer gel is made up of a gelatin matrix doped with a monomer which polymerize and cross-link when exposed to ionizing radiation, thereby inducing a localized change in the gel's density. Details of its properties and manufacture have been previously described by Jirasek et al (2006) . By using the polymer gel to record the 3D dose distribution delivered during treatment, the actual dose received by the phantom was compared to the planned dose, closing the loop on the entire treatment process using 3D ultrasound guidance. Four target isocenter locations were chosen during treatment planning on the Eclipse system (Varian, Palo Alto, CA), each near the center of one of the four polymer gel bottles on the phantom. Each isocenter was given the three field dose plan shown in Fig. 4 . The 6 MV beam from the Varian 21EX LINAC was chosen to deliver the radiation with square fields 30 mm wide. A dose of 15 Gy was assigned to each isocenter. On the day of treatment delivery, the OPTOTRAK was positioned inside the treatment unit against the wall at the inferior end of the couch, while the Voluson 730 was stationed laterally beside the couch. To calibrate OPTOTRAK to the LINAC machine isocenter (the transformation LT O? in Fig. 1 ), the patient alignment lasers were used. The lateral and overhead laser crosshair locations on the sides of a box positioned on the couch were touched by a calibrated stylus while OPTOTRAK measured its tip location using IREDs attached to the stylus base. The stylus tip position thus measured corresponds to a point lying on one of the orthogonal axes of the LINAC coordinate system. By shifting the couch, and thereby the points of intercept between the surface of the box and lasers, 10 different points along the left-right and anterior-posterior axis of the LINAC coordinate system were sampled using the stylus. These points were projected onto the least squares fit plane and the best fit orthogonal axis, along with the origin (isocenter location), were solved using constrained least squares. In addition to using 3D ultrasound localization to position the phantom for irradiation of the four targets, three other independent methods were also used to localize the target in the treatment room before irradiation to allow comparison of these approaches. For each target, the procedures performed before administering the planned dose are described below. Laser Positioning The conventional method of aligning set-up marks placed during the simulation procedure to the guidance lasers inside the treatment room was first used to position the phantom. Couch shifts were used to implement the displacement from the reference points drawn on the phantom during simulation to the individual target locations given by the treatment planning system. After laser positioning, an artificial set-up error was introduced for each target by shifting the couch using the displacements shown in Table 1 . These couch shifts were chosen to investigate errors along each of the coordinate axes separately as well as combined. The 5 mm level corresponds to the magnitude of interfractional organ motion typically encountered in the prostate ( Langen and Jones, 2001 ). 3D Ultrasound Localization To reposition the phantom in the correct treatment position, the 3D ultrasound guidance system was used. A 3D ultrasound scan with views of the balloons inside the box on the phantom was acquired while tracking the probe position with OPTOTRAK ( O?T P ). This image was rigidly registered to a similar image taken previously during the simulation procedure ( U?T U ) by maximizing the image correlation coefficient using Amira (TGS, San Diego, CA). The simulation 3D ultrasound had been registered prior to treatment to the simulation CT using methods previously described. These results, along with calibration parameters LT O? and P?T U? were substituted into Equation (1) to find the shifts required to bring the target into alignment with the LINAC isocenter. These shifts are displayed in Table 1 . Note that it is possible to calculate the error from the other target localization methods by subtracting the shift from 3D ultrasound and adding the shift from another method. Freehand Ultrasound Localization Before the correction shifts in Table 1 were implemented using the couch, volumetric ultrasound data using the same probe, but with a freehand scanning technique were collected by acquiring a series of 2D image slices while manually sweeping and tracking the probe position over the phantom surface. The purpose of this test is to compare a combination of freehand scanning and contour-based ultrasound-to-ultrasound registration, currently employed by all existing ultra-sound guidance systems, with a combination of mechanical-sweep scanning and automatic intensity-based ultrasound-to-ultrasound registration, as was utilized in this study. This allows the localization accuracy of the two approaches to be directly compared and provide further insight into sources of error. The freehand data was not used for positioning the phantom but was stored for off-line analysis. The contours of the balloons in each slice of the data set were extracted by thresholding and reconstructed into surface points as shown in Fig. 5 using OPTOTRAK measurements of the probe position during scanning and the probe calibration matrix. The freehand ultra-sound acquired during treatment was rigidly registered to a similar freehand volume acquired during simulation ( U?T U ) by using the ICP algorithm ( Besl and McKay, 1992 ) to align the surface points extracted from each. No manual intervention was required to initialize the registration, and the algorithm converged within 30 iterations in each case. The simulation freehand ultrasound was registered to the simulation CT using the same technique employed for 3D ultrasound images. Finally, the target location was calculated using these results and Equation (1) . OPTOTRAK Localization As a final check of the target location before the phantom was irradiated, the phantom position ( O?T Pat ) was directly measured by OPTOTRAK using the IREDs left intact from simulation. The following series of transformations was then used to localize the target: (3) X iso L = T O ? L T Pat O ? T CT Pat X iso CT . where LT O? and PatT CT are as defined previously and CTx iso is the isocenter of the radiation plan with respect to the CT image. The target location determined using Equation (3) was recorded for o ine comparison with 3D ultrasound localization. Polymer Gel Response Readout To extract dose information from the irradiated gel bottles, radiation induced density change in the gel was detected by CT imaging as subtle changes in its Hounsfield units ( HU ). CT imaging was performed at Canada Diagnostic Centers (Vancouver, Canada) with the Toshiba Aquilion 64 multi-slice CT (Toshiba, Japan). To optimize image quality, a CT imaging protocol following the guidelines set by Hilts et al (2005) was used. To prepare for imaging, each gel bottle was removed one at a time from the phantom and placed on a Styrofoam cradle securely taped to the CT table. This ensured that all the bottles were placed in the same position within the CT bore during CT scanning. Each gel bottle was scanned individually, and orientated so that its axis of symmetry was in approximate alignment with the CT gantry axis of rotation to reduce the presence of imaging artifacts. The CT imaging parameters were 0.5 mm slice thickness, 0.335 mm pixel size, 135 kV tube voltage, 350 m A tube current, and 0.5s scan time. To improve image SNR, each bottle was scanned 5 times, and the images were averaged. In addition to the four irradiated bottles, a bottle of unirradiated gel was also scanned using the same imaging parameters. The average image of the unirradiated bottle was subtracted from the average image of each irradiated bottle to perform background subtraction and form a difference image displaying the change in gel HU after irradiation. The difference image near one of the targets is shown in Fig. 6 . Aside from the bright pixels around the edges of the bottle due to slight misalignment of the irradiated and unirradiated bottles used to calculate the difference image, the bright cluster of pixels corresponding to the location where the gel received the highest dose can clearly be seen. To evaluate the accuracy of the target localization methods tested in this study, the difference image for each gel bottle was registered with the simulation CT using BB fiducial markers placed on the bottles. This allowed the planned dose geometry, defined in the simulation CT coordinates, to be transferred to the difference image. Next, the actual irradiated isocenter location was determined by registering the 3D dose plan, given by the treatment planning software as a 3D matrix of dose values, with the difference image by maximizing the image correlation coefficient in Amira as previously done for ultrasound images. Jirasek et al (2006) have previously shown that the gel formulation used in this experiment has an approximate linear dose response of 0.32 HUGy ?1 . In addition, the planned isocenter location determined previously was used to initialize the algorithm. As this should be close to the irradiated isocenter location, the possibility of mis-registration via convergence to the wrong local minimum is unlikely. The 3D Euclidean distance between the planned and irradiated isocenter locations was taken to be the target localization error. Since the 3D ultrasound guidance was used to finalize the phantom position before it was irradiated, the target localization errors determined from the gel directly correspond to the overall accuracy of 3D ultrasound-assisted positioning. The accuracy of the other methods tested were derived by comparing the corresponding target localization results with that obtained with 3D ultrasound. For example, the difference in the target location determined by 3D ultrasound and laser positioning can be found by adding the simulated error and the correction shifts shown in Table 1 . This difference can then be applied to the irradiated target location to find the positioning error that would have occurred from laser alignment. The target localization error for the freehand ultrasound and OPTOTRAK localization methods were similarly obtained.  Simulation CT and Ultrasound Registration Accuracy CT and ultrasound images of the phantom shown in Fig. 2 were registered using the series of transformations shown in the left panel of Fig. 1 . This phantom contains wire crosses to facilitate ultrasound probe calibration and speed of sound verification, and 8 IREDs attached outside as fiducial markers. It is filled with an ultrasound tissue equivalent material consisting of (by weight) 3% high gel strength agar (Sigma-Aldrich, St. Louis, MO), 88.4% distilled water (Anachemia, Montreal, Canada), and 8.6% n-propanol (Fisher Scientific, Hampton, NH) to regulate its acoustic velocity to 1540 ms ?1 ( Burlew et al, 1980 ). Embedded within the gel were 43 aluminum ball bearings (BBs) of 1 mm diameter to act as point features. These ball bearings were pushed into the gel with a needle just before it coalesced and were randomly distributed throughout the phantom. The speed of sound in the phantom was verified to be within 0.5% of 1540ms?1 by comparing the physical distance between the center of two vertical wire crosses with their observed distance in an ultrasound image. Therefore, geometric distortions in ultrasound images of the phantom due to speed of sound error are expected to be insignificant. The calibration matrix UT P of our ultrasound probe was determined using the methods described by Poon and Rohling (2005) . Briefly, the ‘IXI’ shaped wire crosses in the phantom were scanned while tracking both the probe and phantom positions with the OPTOTRAK. The resulting ultrasound image was rigidly registered to a virtual model of the wires generated using their locations with respect to the IRED markers on the phantom, which had been precisely measured during its construction. This registration step was performed using the Amira 3D visualization toolkit (TGS, San Diego, CA) by maximizing the image correlation coefficient ( Fitzpatrick and Sonka, 2000 ). The result of this registration ( UT Phan ), and the OPTOTRAK measurements of the phantom and probe positions ( PhanT O and PT O , respectively)were then used to calculate UT P : (2) T P U = T Phan U T O Phan ( T O P ) ? 1 CT imaging was performed at the British Columbia Cancer Agency (BCCA) with a PQ5000 CT simulator (Picker International, Cleveland, OH). On the same day, the phantom was imaged using 3D ultrasound, as shown in Fig. 2 . Nine ultrasound volumes were required in order to image the entire phantom. The required registration parameters OT Pat and PT O were measured using OPTOTRAK for each volume. The remaining unknown PatT CT was calculated by least-squares minimization of the distance between the measured IRED locations on the phantom and their corresponding locations in the CT scan ( Horn, 1987 ). IRED locations in CT were determined by finding their image centroid and applying a calibrated offset (1.47 mm ) along their axis of symmetry to account for the offset of the IRED inside its housing. The BB locations in CT were identified by calculating the image centroid in a surrounding region of interest, as shown in Fig. 3 . The BB locations in ultrasound were similarly identified after thresholding was used to remove the comet-tail artifact from ultrasound. Since the BB occupies many voxels in both the CT and ultrasound images, their target localization error (TLE) was considerably smaller than the dimension of a voxel (0.68 × 0.68 × 1.5 mm for CT, 0.55 mm for ultrasound ). The difference in corresponding BB locations in registered CT and ultrasound images was defined as the target registration error (TRE) and used to evaluate the accuracy of the registration. Since ultrasound data was acquired with a curvilinear array probe, for which beam width, line density and lateral resolution decreases below the image center, BB locations near the center of the volume were selected as target locations for comparison.  Target Localization Accuracy of Entire System In order to determine the overall accuracy of the proposed system, the entire process of radiation therapy, from simulation, to 3D ultrasound guidance, and finally irradiation, was performed on the phantom shown in Fig. 4 . This phantom consists of a large box containing the same ultrasound tissue equivalent material as described previously ( Burlew et al, 1980 ) and 3 embedded balloons filled with the same material plus a high concentration of cellulose to act as hyperechogenic features in ultrasound. The lid of the box was opened to allow access by the ultrasound probe. Eight IREDs were taped to the side wall of the box as CT fiducials. In addition, four polypropylene NALGENE ® bottles containing a radiosensitive polymer gel were rigidly secured to the wooden base with cable ties. The polymer gel is made up of a gelatin matrix doped with a monomer which polymerize and cross-link when exposed to ionizing radiation, thereby inducing a localized change in the gel's density. Details of its properties and manufacture have been previously described by Jirasek et al (2006) . By using the polymer gel to record the 3D dose distribution delivered during treatment, the actual dose received by the phantom was compared to the planned dose, closing the loop on the entire treatment process using 3D ultrasound guidance. Four target isocenter locations were chosen during treatment planning on the Eclipse system (Varian, Palo Alto, CA), each near the center of one of the four polymer gel bottles on the phantom. Each isocenter was given the three field dose plan shown in Fig. 4 . The 6 MV beam from the Varian 21EX LINAC was chosen to deliver the radiation with square fields 30 mm wide. A dose of 15 Gy was assigned to each isocenter. On the day of treatment delivery, the OPTOTRAK was positioned inside the treatment unit against the wall at the inferior end of the couch, while the Voluson 730 was stationed laterally beside the couch. To calibrate OPTOTRAK to the LINAC machine isocenter (the transformation LT O? in Fig. 1 ), the patient alignment lasers were used. The lateral and overhead laser crosshair locations on the sides of a box positioned on the couch were touched by a calibrated stylus while OPTOTRAK measured its tip location using IREDs attached to the stylus base. The stylus tip position thus measured corresponds to a point lying on one of the orthogonal axes of the LINAC coordinate system. By shifting the couch, and thereby the points of intercept between the surface of the box and lasers, 10 different points along the left-right and anterior-posterior axis of the LINAC coordinate system were sampled using the stylus. These points were projected onto the least squares fit plane and the best fit orthogonal axis, along with the origin (isocenter location), were solved using constrained least squares. In addition to using 3D ultrasound localization to position the phantom for irradiation of the four targets, three other independent methods were also used to localize the target in the treatment room before irradiation to allow comparison of these approaches. For each target, the procedures performed before administering the planned dose are described below. Laser Positioning The conventional method of aligning set-up marks placed during the simulation procedure to the guidance lasers inside the treatment room was first used to position the phantom. Couch shifts were used to implement the displacement from the reference points drawn on the phantom during simulation to the individual target locations given by the treatment planning system. After laser positioning, an artificial set-up error was introduced for each target by shifting the couch using the displacements shown in Table 1 . These couch shifts were chosen to investigate errors along each of the coordinate axes separately as well as combined. The 5 mm level corresponds to the magnitude of interfractional organ motion typically encountered in the prostate ( Langen and Jones, 2001 ). 3D Ultrasound Localization To reposition the phantom in the correct treatment position, the 3D ultrasound guidance system was used. A 3D ultrasound scan with views of the balloons inside the box on the phantom was acquired while tracking the probe position with OPTOTRAK ( O?T P ). This image was rigidly registered to a similar image taken previously during the simulation procedure ( U?T U ) by maximizing the image correlation coefficient using Amira (TGS, San Diego, CA). The simulation 3D ultrasound had been registered prior to treatment to the simulation CT using methods previously described. These results, along with calibration parameters LT O? and P?T U? were substituted into Equation (1) to find the shifts required to bring the target into alignment with the LINAC isocenter. These shifts are displayed in Table 1 . Note that it is possible to calculate the error from the other target localization methods by subtracting the shift from 3D ultrasound and adding the shift from another method. Freehand Ultrasound Localization Before the correction shifts in Table 1 were implemented using the couch, volumetric ultrasound data using the same probe, but with a freehand scanning technique were collected by acquiring a series of 2D image slices while manually sweeping and tracking the probe position over the phantom surface. The purpose of this test is to compare a combination of freehand scanning and contour-based ultrasound-to-ultrasound registration, currently employed by all existing ultra-sound guidance systems, with a combination of mechanical-sweep scanning and automatic intensity-based ultrasound-to-ultrasound registration, as was utilized in this study. This allows the localization accuracy of the two approaches to be directly compared and provide further insight into sources of error. The freehand data was not used for positioning the phantom but was stored for off-line analysis. The contours of the balloons in each slice of the data set were extracted by thresholding and reconstructed into surface points as shown in Fig. 5 using OPTOTRAK measurements of the probe position during scanning and the probe calibration matrix. The freehand ultra-sound acquired during treatment was rigidly registered to a similar freehand volume acquired during simulation ( U?T U ) by using the ICP algorithm ( Besl and McKay, 1992 ) to align the surface points extracted from each. No manual intervention was required to initialize the registration, and the algorithm converged within 30 iterations in each case. The simulation freehand ultrasound was registered to the simulation CT using the same technique employed for 3D ultrasound images. Finally, the target location was calculated using these results and Equation (1) . OPTOTRAK Localization As a final check of the target location before the phantom was irradiated, the phantom position ( O?T Pat ) was directly measured by OPTOTRAK using the IREDs left intact from simulation. The following series of transformations was then used to localize the target: (3) X iso L = T O ? L T Pat O ? T CT Pat X iso CT . where LT O? and PatT CT are as defined previously and CTx iso is the isocenter of the radiation plan with respect to the CT image. The target location determined using Equation (3) was recorded for o ine comparison with 3D ultrasound localization.  Laser Positioning The conventional method of aligning set-up marks placed during the simulation procedure to the guidance lasers inside the treatment room was first used to position the phantom. Couch shifts were used to implement the displacement from the reference points drawn on the phantom during simulation to the individual target locations given by the treatment planning system. After laser positioning, an artificial set-up error was introduced for each target by shifting the couch using the displacements shown in Table 1 . These couch shifts were chosen to investigate errors along each of the coordinate axes separately as well as combined. The 5 mm level corresponds to the magnitude of interfractional organ motion typically encountered in the prostate ( Langen and Jones, 2001 ).  3D Ultrasound Localization To reposition the phantom in the correct treatment position, the 3D ultrasound guidance system was used. A 3D ultrasound scan with views of the balloons inside the box on the phantom was acquired while tracking the probe position with OPTOTRAK ( O?T P ). This image was rigidly registered to a similar image taken previously during the simulation procedure ( U?T U ) by maximizing the image correlation coefficient using Amira (TGS, San Diego, CA). The simulation 3D ultrasound had been registered prior to treatment to the simulation CT using methods previously described. These results, along with calibration parameters LT O? and P?T U? were substituted into Equation (1) to find the shifts required to bring the target into alignment with the LINAC isocenter. These shifts are displayed in Table 1 . Note that it is possible to calculate the error from the other target localization methods by subtracting the shift from 3D ultrasound and adding the shift from another method.  Freehand Ultrasound Localization Before the correction shifts in Table 1 were implemented using the couch, volumetric ultrasound data using the same probe, but with a freehand scanning technique were collected by acquiring a series of 2D image slices while manually sweeping and tracking the probe position over the phantom surface. The purpose of this test is to compare a combination of freehand scanning and contour-based ultrasound-to-ultrasound registration, currently employed by all existing ultra-sound guidance systems, with a combination of mechanical-sweep scanning and automatic intensity-based ultrasound-to-ultrasound registration, as was utilized in this study. This allows the localization accuracy of the two approaches to be directly compared and provide further insight into sources of error. The freehand data was not used for positioning the phantom but was stored for off-line analysis. The contours of the balloons in each slice of the data set were extracted by thresholding and reconstructed into surface points as shown in Fig. 5 using OPTOTRAK measurements of the probe position during scanning and the probe calibration matrix. The freehand ultra-sound acquired during treatment was rigidly registered to a similar freehand volume acquired during simulation ( U?T U ) by using the ICP algorithm ( Besl and McKay, 1992 ) to align the surface points extracted from each. No manual intervention was required to initialize the registration, and the algorithm converged within 30 iterations in each case. The simulation freehand ultrasound was registered to the simulation CT using the same technique employed for 3D ultrasound images. Finally, the target location was calculated using these results and Equation (1) .  OPTOTRAK Localization As a final check of the target location before the phantom was irradiated, the phantom position ( O?T Pat ) was directly measured by OPTOTRAK using the IREDs left intact from simulation. The following series of transformations was then used to localize the target: (3) X iso L = T O ? L T Pat O ? T CT Pat X iso CT . where LT O? and PatT CT are as defined previously and CTx iso is the isocenter of the radiation plan with respect to the CT image. The target location determined using Equation (3) was recorded for o ine comparison with 3D ultrasound localization.  Polymer Gel Response Readout To extract dose information from the irradiated gel bottles, radiation induced density change in the gel was detected by CT imaging as subtle changes in its Hounsfield units ( HU ). CT imaging was performed at Canada Diagnostic Centers (Vancouver, Canada) with the Toshiba Aquilion 64 multi-slice CT (Toshiba, Japan). To optimize image quality, a CT imaging protocol following the guidelines set by Hilts et al (2005) was used. To prepare for imaging, each gel bottle was removed one at a time from the phantom and placed on a Styrofoam cradle securely taped to the CT table. This ensured that all the bottles were placed in the same position within the CT bore during CT scanning. Each gel bottle was scanned individually, and orientated so that its axis of symmetry was in approximate alignment with the CT gantry axis of rotation to reduce the presence of imaging artifacts. The CT imaging parameters were 0.5 mm slice thickness, 0.335 mm pixel size, 135 kV tube voltage, 350 m A tube current, and 0.5s scan time. To improve image SNR, each bottle was scanned 5 times, and the images were averaged. In addition to the four irradiated bottles, a bottle of unirradiated gel was also scanned using the same imaging parameters. The average image of the unirradiated bottle was subtracted from the average image of each irradiated bottle to perform background subtraction and form a difference image displaying the change in gel HU after irradiation. The difference image near one of the targets is shown in Fig. 6 . Aside from the bright pixels around the edges of the bottle due to slight misalignment of the irradiated and unirradiated bottles used to calculate the difference image, the bright cluster of pixels corresponding to the location where the gel received the highest dose can clearly be seen. To evaluate the accuracy of the target localization methods tested in this study, the difference image for each gel bottle was registered with the simulation CT using BB fiducial markers placed on the bottles. This allowed the planned dose geometry, defined in the simulation CT coordinates, to be transferred to the difference image. Next, the actual irradiated isocenter location was determined by registering the 3D dose plan, given by the treatment planning software as a 3D matrix of dose values, with the difference image by maximizing the image correlation coefficient in Amira as previously done for ultrasound images. Jirasek et al (2006) have previously shown that the gel formulation used in this experiment has an approximate linear dose response of 0.32 HUGy ?1 . In addition, the planned isocenter location determined previously was used to initialize the algorithm. As this should be close to the irradiated isocenter location, the possibility of mis-registration via convergence to the wrong local minimum is unlikely. The 3D Euclidean distance between the planned and irradiated isocenter locations was taken to be the target localization error. Since the 3D ultrasound guidance was used to finalize the phantom position before it was irradiated, the target localization errors determined from the gel directly correspond to the overall accuracy of 3D ultrasound-assisted positioning. The accuracy of the other methods tested were derived by comparing the corresponding target localization results with that obtained with 3D ultrasound. For example, the difference in the target location determined by 3D ultrasound and laser positioning can be found by adding the simulated error and the correction shifts shown in Table 1 . This difference can then be applied to the irradiated target location to find the positioning error that would have occurred from laser alignment. The target localization error for the freehand ultrasound and OPTOTRAK localization methods were similarly obtained.  Results and Discussion Simulation CT and Ultrasound Registration Accuracy The target registration error (TRE) of 65 BBs observed in registered CT and ultrasound volumes were ?0.50 ± 0.53 mm , ?0.12 ± 0.70 mm , and 0.23 ± 0.33 mm (mean ± standard deviation) in each orthogonal direction, indicating the small level of systematic errors in this portion of our system. The overall root-mean-square (RMS) 3D TRE was 1.09 mm . No noticeable detrimental effects on the performance of the IREDs were found after exposure to x-rays, supporting their continued use as CT fiducials. The major sources of error in these registration steps include calculating the IRED locations in CT, and the ultrasound probe calibration matrix UT P . The effects of errors in determining CT IRED locations on the accuracy of PatT CT can be reduced if this error is non-systematic, and a sufficient number of IREDs are used to establish point correspondences. The RMS fiducial registration error (FRE) for the 8 IREDs was found to be 0.88 mm . Although the OPTOTRAK IREDs were found to be suitable as fiducial markers in CT for this study, it may be desirable to attach them to a larger base object that is clearly defined in CT to improve the accuracy of determining their locations. The accuracy of the probe calibration process used here has been previously evaluated by Poon and Rohling (2005) using the same ultrasound system and probe. The RMS point accuracy was found to be 2.15 mm . However, the RMS 3D TRE for this experiment was 1.09 mm , including errors from PatT CT as well. This discrepancy may be due to the different materials used as targets and the background material by Poon and Rohling (2005) . In a similar study, Tomé et al (2002) reported ultrasound target localization errors of 0.2 ± 0.7 mm , 0.9 ± 0.6 mm , and 0.6 ± 1.0 mm along each orthogonal axis for the SonArray system when compared to target locations in the planning CT. These results are comparable to the CT and ultrasound TRE in this study. Target Localization Accuracy of Entire System The accuracy of all four methods tested for localizing the four targets are summarized in Table 2 . The positioning results for one target is also shown in Fig. 7 . The target localization accuracy of the optical guidance methods tested ( i.e. , laser and OPTOTRAK) were better overall than ultrasound guidance with the proposed system using either 3D or freehand data. As mentioned in the introduction, this is not surprising, because the number of error sources for the laser and OPTOTRAK methods are significantly less than ultrasound guidance, as can be seen from Table 3 . Nevertheless, the extra sources of inaccuracy involved with ultrasound target localization only amounted to approximately 1 mm of additional error in practice compared to optical guidance. In addition, the positioning accuracy of the proposed system using 3D ultrasound data was comparable to using freehand data and contour-based registration. The major sources of error and their estimated magnitudes for each target localization technique tested are summarized in Table 3 and discussed below. Laser Positioning The accuracy of the conventional laser positioning method is limited by the accuracy of the alignment lasers, and couch movement used to implement the displacement from the reference marks on the phantom to the actual target location. Quality assurance procedures at the BCCA ensures that the alignment lasers are accurate to within 2 mm in each axis in marking the true LINAC isocenter location. In addition, they are 0.5 mm wide. Therefore, in the worse-case scenario, a maximum error of 3 × 2.25 2 = 3.9 m m can occur with the laser indicators. In practice, however, both the laser and couch errors were considerably smaller than their maximum possible values, as shown by the small overall laser error magnitudes in Table 2 . Couch Error The motor-driven couch is only able to move in 1 mm increments. Thus, a maximum error of 3 × 0.5 2 = 0.87 m m in the phantom position due to finite couch precision is possible. <sup>U</sup>T<sub>CT</sub> Error The method used for registering simulation CT and ultrasound ( UT CT ) was evaluated in the previous section on a similar phantom, where a RMS TRE of 1.09 mm was obtained. This level of accuracy can be expected in this case as well. <sup>P?</sup>T<sub>U?</sub> Error The probe calibration error during simulation UT P is already included in UT CT error. However, its effects during treatment ( P?T U? ) must also be taken into account. Since the overall RMS accuracy of UTCT was found to be 1.09 mm , error due to probe calibration (both UT P and P?T U? ) can be expected to be less than this figure. The same reasoning applies to PatT CT . <sup>U?</sup>T<sub>U</sub> Error The 3D ultrasound-to-ultrasound image registration algorithm used in this study has previously been tested on a cross-wire phantom. The image registration results were compared to a gold standard obtained from OPTOTRAK measurements of the ultrasound probe positions during image acquisition and knowledge of the probe calibration parameter. A RMS registration accuracy within the order of the pixel size, 0.62 mm , was achieved ( Wang, 2006 ). Since the phantom imaged in this experiment contains similar material and idealized, well defined features with high contrast, a comparable image registration accuracy can be expected. An additional benefit of our system is that the effects of systematic ultrasound imaging errors, such as inaccurate probe calibration ( UT P ), speed of sound distortions of the image geometry, or even tissue deformation due to applied probe pressure, can be minimized if U?T U = I , where I is the identity matrix. This can be demonstrated by introducing a transformation matrix T err representing this error into Equation (1) : (4) X iso L = T O ? L T P ? O ? T U ? P ? ( T err ) T U U ? ( T err ) 1 U T P T O P T Pat O T CT Pat X iso CT . Even if U?T U ? I , some error cancellation is possible. In practice, treatment and simulation ultrasound images are likely to be taken from similar viewpoints and contain similar anatomical features. This, along with the use of dedicated 3D ultrasound probes, which removes the need for the operator to manually sweep the probe across the skin, promotes the reproducibility of ultrasound images used for registration and the likelihood of error cancellation. Additional errors are introduced when registering freehand ultrasound data. These include inaccuracies in freehand reconstruction, ultrasound and OPTOTRAK data synchronization, and contouring ( Rohling and Gee, 1996 ). These errors cause variations in the reconstructed surface contours to occur from different freehand images (an example reconstruction was shown in Fig. 5 ). The variations between contours reconstructed from the simulation and treatment freehand images can be gauged by inspecting the residual error between closest matching contour points after registration using the ICP algorithm. For localization of the four targets in this experiment, the mean RMS contour registration error was 1.29 mm . It is important to note that even with the presence of such errors, it is still possible for an accurate registration result for U?T U to be obtained, as long as the errors are sufficiently small and uniformly distributed in all directions over all the contour points. Thus, contour-based registration of freehand data was still capable of achieving a similar accuracy as registration of 3D ultrasound data in our experiment. Phantom effects on Experimental Results With the phantom used in this experiment, the effects of any ultrasound-to-ultrasound image registration error on the accuracy of the target localization results may be amplified by the lever-arm effects. This is because the target locations are not within the ultrasound image field of view, since the polymer gel bottles are adjacent to the box used for ultrasound scanning. The mean distance from the center of the simulation ultrasound volume to the four targets within the gel bottles is 160 mm . Even with a registration error of 1° between the simulation and treatment ultrasound volumes, the misalignment at this distance away would be 2.8 mm . In conventional use of our system, the target isocenter would be directly imaged using ultrasound. However, this was not possible with the phantom in this experiment because it was impractical to incorporate the polymer gel into the box used for ultrasound scanning. Nevertheless, since the target localization error was still relatively low for both the 3D and freehand ultrasound methods and well within the expected upper bounds, it seems that this effects did not have a significant impact on the overall results. It is important to recognize that the phantom used in this experiment represents an idealized patient, and that the positioning accuracy achieved by the various methods tested represent lower bounds. The automatic pixel-intensity based 3D ultrasound-to-ultrasound registration results obtained correspond to the best-case scenario for image registration, as there were many clear features present in the ultrasound image. In addition, artifacts such as refraction and speed of sound error were not present as would likely be for a real patient. The presence of clear features with high contrast also enables the extraction of contours from freehand ultrasound images of the phantom to be performed automatically. In ultrasound images of real anatomy, contours may need to be drawn manually, which increases the likelihood of further errors. The phantom is also incompressible, unlike real tissue. Thus, non-rigid organ motion was not present to impair the performance of the image registration algorithm, which assumes a rigid transformation between images. Since accurate registration of the anatomy is the vital link between simulation and treatment stages, the presence of non-rigid organ motion could potentially pose serious problems for image guidance techniques for radiotherapy. A potentially significant source of error in practice for freehand ultrasound is caused by tissue deformation from probe pressure as it is manually swept over the area of interest to be imaged ( Artignan et al, 2004 ; McGahan et al, 2004 ). If this deformation is non-uniform in different slices of the freehand data acquired, then the locations of features in the reconstructed volume will appear to be out of alignment. Since the phantom imaged in this experiment is incompressible, this aspect of freehand ultrasound target localization is not tested. It should be noted that the additional positioning error associated with ultrasound guidance in this study is not an indication that ultrasound is not valuable in target localization for human subjects. Indeed, internal day-to-day organ shifts and skin mark migration in real patients will introduce additional errors when using external markers to position the patient via alignment to lasers, or optical tracking by cameras. In contrast, ultrasound imaging can enable the internal anatomy surrounding the target to be directly visualized, whereas optical guidance techniques can only localize external fiducials on the surface of the patient at some distance from the treatment target. Since a rigid phantom is positioned in this experiment, the full advantage of ultrasound over laser and OPTOTRAK localization methods is not fully exploited. Hence, even though more accurate target localization results were obtained using optical guidance than 3D ultrasound guidance in this experiment, the presence of internal organ motion in real patients means that the former will not necessarily be more accurate in clinical practice. While it is impossible to simulate the entire behavior of a real patient under clinical conditions using a phantom, the study presented herein still provides pertinent information that would otherwise be impossible to obtain from patients. Currently, accurate verification of 3D dose distribution delivered to tissue is not possible. Hence, the true irradiated target location can only be accurately determined from phantom studies. Comparison to Previous Studies Studies of target localization accuracy and quality assurance of ultrasound patient positioning systems for radiotherapy have not been widely reported in the literature, even though there has been a proliferation of these systems in clinical usage. We previously compared our CT to ultrasound registration results with those obtained by Tomé et al (2002) using the SonArray ultrasound target localization system. In the same manuscript, ultrasound localization accuracy was compared to optical-guidance and were found to agree to within 1 mm along each orthogonal axis. The overall target localization accuracy of our 3D ultrasound positioning system, as shown in Table 2 , was measured to be slightly larger than that of Tomé et al (2002) . However, the experiment described herein does not use optical-guidance as the ‘ground truth’ for target localization accuracy. Instead, the phantom is positioned like a real patient in the treatment room with respect to an absolute frame of reference (that of the LINAC isocenter). Furthermore, the phantom is irradiated, and changes in its material properties are compared with the treatment plan to close the loop on the entire treatment process in order to verify the accuracy of 3D ultrasound positioning. Thus, the entire process of radiotherapy treatment, including simulation imaging, treatment planning, patient positioning at the time of treatment, and irradiation, is simulated in this experiment. Errors such as couch movement inaccuracy, inaccurate calibration of the optical camera system to the LINAC, and accuracy of the LINAC itself in delivering the prescribed dose are included in the target localization error, giving a more realistic measure of the overall expected treatment accuracy. No previous study on image-guidance systems for radiotherapy has attempted to show this type of start-to-end validation. The general experimental methodologies concerning the use of polymer gel dosimetry described herein can be adopted for quality assurance testing of other image-guided radiotherapy systems as well.  Simulation CT and Ultrasound Registration Accuracy The target registration error (TRE) of 65 BBs observed in registered CT and ultrasound volumes were ?0.50 ± 0.53 mm , ?0.12 ± 0.70 mm , and 0.23 ± 0.33 mm (mean ± standard deviation) in each orthogonal direction, indicating the small level of systematic errors in this portion of our system. The overall root-mean-square (RMS) 3D TRE was 1.09 mm . No noticeable detrimental effects on the performance of the IREDs were found after exposure to x-rays, supporting their continued use as CT fiducials. The major sources of error in these registration steps include calculating the IRED locations in CT, and the ultrasound probe calibration matrix UT P . The effects of errors in determining CT IRED locations on the accuracy of PatT CT can be reduced if this error is non-systematic, and a sufficient number of IREDs are used to establish point correspondences. The RMS fiducial registration error (FRE) for the 8 IREDs was found to be 0.88 mm . Although the OPTOTRAK IREDs were found to be suitable as fiducial markers in CT for this study, it may be desirable to attach them to a larger base object that is clearly defined in CT to improve the accuracy of determining their locations. The accuracy of the probe calibration process used here has been previously evaluated by Poon and Rohling (2005) using the same ultrasound system and probe. The RMS point accuracy was found to be 2.15 mm . However, the RMS 3D TRE for this experiment was 1.09 mm , including errors from PatT CT as well. This discrepancy may be due to the different materials used as targets and the background material by Poon and Rohling (2005) . In a similar study, Tomé et al (2002) reported ultrasound target localization errors of 0.2 ± 0.7 mm , 0.9 ± 0.6 mm , and 0.6 ± 1.0 mm along each orthogonal axis for the SonArray system when compared to target locations in the planning CT. These results are comparable to the CT and ultrasound TRE in this study.  Target Localization Accuracy of Entire System The accuracy of all four methods tested for localizing the four targets are summarized in Table 2 . The positioning results for one target is also shown in Fig. 7 . The target localization accuracy of the optical guidance methods tested ( i.e. , laser and OPTOTRAK) were better overall than ultrasound guidance with the proposed system using either 3D or freehand data. As mentioned in the introduction, this is not surprising, because the number of error sources for the laser and OPTOTRAK methods are significantly less than ultrasound guidance, as can be seen from Table 3 . Nevertheless, the extra sources of inaccuracy involved with ultrasound target localization only amounted to approximately 1 mm of additional error in practice compared to optical guidance. In addition, the positioning accuracy of the proposed system using 3D ultrasound data was comparable to using freehand data and contour-based registration. The major sources of error and their estimated magnitudes for each target localization technique tested are summarized in Table 3 and discussed below. Laser Positioning The accuracy of the conventional laser positioning method is limited by the accuracy of the alignment lasers, and couch movement used to implement the displacement from the reference marks on the phantom to the actual target location. Quality assurance procedures at the BCCA ensures that the alignment lasers are accurate to within 2 mm in each axis in marking the true LINAC isocenter location. In addition, they are 0.5 mm wide. Therefore, in the worse-case scenario, a maximum error of 3 × 2.25 2 = 3.9 m m can occur with the laser indicators. In practice, however, both the laser and couch errors were considerably smaller than their maximum possible values, as shown by the small overall laser error magnitudes in Table 2 . Couch Error The motor-driven couch is only able to move in 1 mm increments. Thus, a maximum error of 3 × 0.5 2 = 0.87 m m in the phantom position due to finite couch precision is possible. <sup>U</sup>T<sub>CT</sub> Error The method used for registering simulation CT and ultrasound ( UT CT ) was evaluated in the previous section on a similar phantom, where a RMS TRE of 1.09 mm was obtained. This level of accuracy can be expected in this case as well. <sup>P?</sup>T<sub>U?</sub> Error The probe calibration error during simulation UT P is already included in UT CT error. However, its effects during treatment ( P?T U? ) must also be taken into account. Since the overall RMS accuracy of UTCT was found to be 1.09 mm , error due to probe calibration (both UT P and P?T U? ) can be expected to be less than this figure. The same reasoning applies to PatT CT . <sup>U?</sup>T<sub>U</sub> Error The 3D ultrasound-to-ultrasound image registration algorithm used in this study has previously been tested on a cross-wire phantom. The image registration results were compared to a gold standard obtained from OPTOTRAK measurements of the ultrasound probe positions during image acquisition and knowledge of the probe calibration parameter. A RMS registration accuracy within the order of the pixel size, 0.62 mm , was achieved ( Wang, 2006 ). Since the phantom imaged in this experiment contains similar material and idealized, well defined features with high contrast, a comparable image registration accuracy can be expected. An additional benefit of our system is that the effects of systematic ultrasound imaging errors, such as inaccurate probe calibration ( UT P ), speed of sound distortions of the image geometry, or even tissue deformation due to applied probe pressure, can be minimized if U?T U = I , where I is the identity matrix. This can be demonstrated by introducing a transformation matrix T err representing this error into Equation (1) : (4) X iso L = T O ? L T P ? O ? T U ? P ? ( T err ) T U U ? ( T err ) 1 U T P T O P T Pat O T CT Pat X iso CT . Even if U?T U ? I , some error cancellation is possible. In practice, treatment and simulation ultrasound images are likely to be taken from similar viewpoints and contain similar anatomical features. This, along with the use of dedicated 3D ultrasound probes, which removes the need for the operator to manually sweep the probe across the skin, promotes the reproducibility of ultrasound images used for registration and the likelihood of error cancellation. Additional errors are introduced when registering freehand ultrasound data. These include inaccuracies in freehand reconstruction, ultrasound and OPTOTRAK data synchronization, and contouring ( Rohling and Gee, 1996 ). These errors cause variations in the reconstructed surface contours to occur from different freehand images (an example reconstruction was shown in Fig. 5 ). The variations between contours reconstructed from the simulation and treatment freehand images can be gauged by inspecting the residual error between closest matching contour points after registration using the ICP algorithm. For localization of the four targets in this experiment, the mean RMS contour registration error was 1.29 mm . It is important to note that even with the presence of such errors, it is still possible for an accurate registration result for U?T U to be obtained, as long as the errors are sufficiently small and uniformly distributed in all directions over all the contour points. Thus, contour-based registration of freehand data was still capable of achieving a similar accuracy as registration of 3D ultrasound data in our experiment.  Laser Positioning The accuracy of the conventional laser positioning method is limited by the accuracy of the alignment lasers, and couch movement used to implement the displacement from the reference marks on the phantom to the actual target location. Quality assurance procedures at the BCCA ensures that the alignment lasers are accurate to within 2 mm in each axis in marking the true LINAC isocenter location. In addition, they are 0.5 mm wide. Therefore, in the worse-case scenario, a maximum error of 3 × 2.25 2 = 3.9 m m can occur with the laser indicators. In practice, however, both the laser and couch errors were considerably smaller than their maximum possible values, as shown by the small overall laser error magnitudes in Table 2 .  Couch Error The motor-driven couch is only able to move in 1 mm increments. Thus, a maximum error of 3 × 0.5 2 = 0.87 m m in the phantom position due to finite couch precision is possible.  <sup>U</sup>T<sub>CT</sub> Error The method used for registering simulation CT and ultrasound ( UT CT ) was evaluated in the previous section on a similar phantom, where a RMS TRE of 1.09 mm was obtained. This level of accuracy can be expected in this case as well.  <sup>P?</sup>T<sub>U?</sub> Error The probe calibration error during simulation UT P is already included in UT CT error. However, its effects during treatment ( P?T U? ) must also be taken into account. Since the overall RMS accuracy of UTCT was found to be 1.09 mm , error due to probe calibration (both UT P and P?T U? ) can be expected to be less than this figure. The same reasoning applies to PatT CT .  <sup>U?</sup>T<sub>U</sub> Error The 3D ultrasound-to-ultrasound image registration algorithm used in this study has previously been tested on a cross-wire phantom. The image registration results were compared to a gold standard obtained from OPTOTRAK measurements of the ultrasound probe positions during image acquisition and knowledge of the probe calibration parameter. A RMS registration accuracy within the order of the pixel size, 0.62 mm , was achieved ( Wang, 2006 ). Since the phantom imaged in this experiment contains similar material and idealized, well defined features with high contrast, a comparable image registration accuracy can be expected. An additional benefit of our system is that the effects of systematic ultrasound imaging errors, such as inaccurate probe calibration ( UT P ), speed of sound distortions of the image geometry, or even tissue deformation due to applied probe pressure, can be minimized if U?T U = I , where I is the identity matrix. This can be demonstrated by introducing a transformation matrix T err representing this error into Equation (1) : (4) X iso L = T O ? L T P ? O ? T U ? P ? ( T err ) T U U ? ( T err ) 1 U T P T O P T Pat O T CT Pat X iso CT . Even if U?T U ? I , some error cancellation is possible. In practice, treatment and simulation ultrasound images are likely to be taken from similar viewpoints and contain similar anatomical features. This, along with the use of dedicated 3D ultrasound probes, which removes the need for the operator to manually sweep the probe across the skin, promotes the reproducibility of ultrasound images used for registration and the likelihood of error cancellation. Additional errors are introduced when registering freehand ultrasound data. These include inaccuracies in freehand reconstruction, ultrasound and OPTOTRAK data synchronization, and contouring ( Rohling and Gee, 1996 ). These errors cause variations in the reconstructed surface contours to occur from different freehand images (an example reconstruction was shown in Fig. 5 ). The variations between contours reconstructed from the simulation and treatment freehand images can be gauged by inspecting the residual error between closest matching contour points after registration using the ICP algorithm. For localization of the four targets in this experiment, the mean RMS contour registration error was 1.29 mm . It is important to note that even with the presence of such errors, it is still possible for an accurate registration result for U?T U to be obtained, as long as the errors are sufficiently small and uniformly distributed in all directions over all the contour points. Thus, contour-based registration of freehand data was still capable of achieving a similar accuracy as registration of 3D ultrasound data in our experiment.  Phantom effects on Experimental Results With the phantom used in this experiment, the effects of any ultrasound-to-ultrasound image registration error on the accuracy of the target localization results may be amplified by the lever-arm effects. This is because the target locations are not within the ultrasound image field of view, since the polymer gel bottles are adjacent to the box used for ultrasound scanning. The mean distance from the center of the simulation ultrasound volume to the four targets within the gel bottles is 160 mm . Even with a registration error of 1° between the simulation and treatment ultrasound volumes, the misalignment at this distance away would be 2.8 mm . In conventional use of our system, the target isocenter would be directly imaged using ultrasound. However, this was not possible with the phantom in this experiment because it was impractical to incorporate the polymer gel into the box used for ultrasound scanning. Nevertheless, since the target localization error was still relatively low for both the 3D and freehand ultrasound methods and well within the expected upper bounds, it seems that this effects did not have a significant impact on the overall results. It is important to recognize that the phantom used in this experiment represents an idealized patient, and that the positioning accuracy achieved by the various methods tested represent lower bounds. The automatic pixel-intensity based 3D ultrasound-to-ultrasound registration results obtained correspond to the best-case scenario for image registration, as there were many clear features present in the ultrasound image. In addition, artifacts such as refraction and speed of sound error were not present as would likely be for a real patient. The presence of clear features with high contrast also enables the extraction of contours from freehand ultrasound images of the phantom to be performed automatically. In ultrasound images of real anatomy, contours may need to be drawn manually, which increases the likelihood of further errors. The phantom is also incompressible, unlike real tissue. Thus, non-rigid organ motion was not present to impair the performance of the image registration algorithm, which assumes a rigid transformation between images. Since accurate registration of the anatomy is the vital link between simulation and treatment stages, the presence of non-rigid organ motion could potentially pose serious problems for image guidance techniques for radiotherapy. A potentially significant source of error in practice for freehand ultrasound is caused by tissue deformation from probe pressure as it is manually swept over the area of interest to be imaged ( Artignan et al, 2004 ; McGahan et al, 2004 ). If this deformation is non-uniform in different slices of the freehand data acquired, then the locations of features in the reconstructed volume will appear to be out of alignment. Since the phantom imaged in this experiment is incompressible, this aspect of freehand ultrasound target localization is not tested. It should be noted that the additional positioning error associated with ultrasound guidance in this study is not an indication that ultrasound is not valuable in target localization for human subjects. Indeed, internal day-to-day organ shifts and skin mark migration in real patients will introduce additional errors when using external markers to position the patient via alignment to lasers, or optical tracking by cameras. In contrast, ultrasound imaging can enable the internal anatomy surrounding the target to be directly visualized, whereas optical guidance techniques can only localize external fiducials on the surface of the patient at some distance from the treatment target. Since a rigid phantom is positioned in this experiment, the full advantage of ultrasound over laser and OPTOTRAK localization methods is not fully exploited. Hence, even though more accurate target localization results were obtained using optical guidance than 3D ultrasound guidance in this experiment, the presence of internal organ motion in real patients means that the former will not necessarily be more accurate in clinical practice. While it is impossible to simulate the entire behavior of a real patient under clinical conditions using a phantom, the study presented herein still provides pertinent information that would otherwise be impossible to obtain from patients. Currently, accurate verification of 3D dose distribution delivered to tissue is not possible. Hence, the true irradiated target location can only be accurately determined from phantom studies.  Comparison to Previous Studies Studies of target localization accuracy and quality assurance of ultrasound patient positioning systems for radiotherapy have not been widely reported in the literature, even though there has been a proliferation of these systems in clinical usage. We previously compared our CT to ultrasound registration results with those obtained by Tomé et al (2002) using the SonArray ultrasound target localization system. In the same manuscript, ultrasound localization accuracy was compared to optical-guidance and were found to agree to within 1 mm along each orthogonal axis. The overall target localization accuracy of our 3D ultrasound positioning system, as shown in Table 2 , was measured to be slightly larger than that of Tomé et al (2002) . However, the experiment described herein does not use optical-guidance as the ‘ground truth’ for target localization accuracy. Instead, the phantom is positioned like a real patient in the treatment room with respect to an absolute frame of reference (that of the LINAC isocenter). Furthermore, the phantom is irradiated, and changes in its material properties are compared with the treatment plan to close the loop on the entire treatment process in order to verify the accuracy of 3D ultrasound positioning. Thus, the entire process of radiotherapy treatment, including simulation imaging, treatment planning, patient positioning at the time of treatment, and irradiation, is simulated in this experiment. Errors such as couch movement inaccuracy, inaccurate calibration of the optical camera system to the LINAC, and accuracy of the LINAC itself in delivering the prescribed dose are included in the target localization error, giving a more realistic measure of the overall expected treatment accuracy. No previous study on image-guidance systems for radiotherapy has attempted to show this type of start-to-end validation. The general experimental methodologies concerning the use of polymer gel dosimetry described herein can be adopted for quality assurance testing of other image-guided radiotherapy systems as well.  Conclusion The accuracy of a 3D ultrasound system in positioning a rigid phantom for irradiation of four target locations was validated using polymer gel dosimetry. The mean positioning error for the four targets was 2.5 mm . Despite introducing a number of extra sources of error into the target localization process, the overall accuracy of the proposed 3D ultrasound patient positioning system was only approximately 1 mm worse than the optical phantom positioning methods tested, including the conventional radiotherapy technique of using alignment lasers and set-up marks. In clinical practice, the magnitude of interfractional organ motion at most treatment sites is likely to exceed the additional error (approximately 1 mm ) introduced by 3D ultrasound target localization ( Langen and Jones, 2001 ). Since ultrasound guidance is capable of compensating for internal organ motion, using it to position patients for treatment should still present a significant improvement over the current established methods in radiotherapy. The experimental methodology presented in this paper can be readily extended to evaluate the accuracy of other types of patient positioning systems and to include non-rigid errors. 
Border detection in dermoscopy images using statistical region merging Background As a result of advances in skin imaging technology and the development of suitable image processing techniques, during the last decade, there has been a significant increase of interest in the computer-aided diagnosis of melanoma. Automated border detection is one of the most important steps in this procedure, because the accuracy of the subsequent steps crucially depends on it. Methods In this article, we present a fast and unsupervised approach to border detection in dermoscopy images of pigmented skin lesions based on the statistical region merging algorithm. Results The method is tested on a set of 90 dermoscopy images. The border detection error is quantified by a metric in which three sets of dermatologist-determined borders are used as the ground-truth. The proposed method is compared with four state-of-the-art automated methods (orientation-sensitive fuzzy c-means, dermatologist-like tumor extraction algorithm, meanshift clustering, and the modified JSEG method). Conclusion The results demonstrate that the method presented here achieves both fast and accurate border detection in dermoscopy images.  Methods In this article, we present a fast and unsupervised approach to border detection in dermoscopy images of pigmented skin lesions based on the statistical region merging algorithm.  Results The method is tested on a set of 90 dermoscopy images. The border detection error is quantified by a metric in which three sets of dermatologist-determined borders are used as the ground-truth. The proposed method is compared with four state-of-the-art automated methods (orientation-sensitive fuzzy c-means, dermatologist-like tumor extraction algorithm, meanshift clustering, and the modified JSEG method).  Conclusion The results demonstrate that the method presented here achieves both fast and accurate border detection in dermoscopy images.  Materials and Methods Overview of the SRM algorithm SRM is a recent color image segmentation technique based on region growing and merging. The method models segmentation as an inference problem, in which the image is treated as an observed instance of an unknown theoretical image, whose statistical (true) regions are to be reconstructed. The advantages of this method include its simplicity, computational efficiency, and excellent performance without the use of quantization or color space transformations. Let I be an observed image that contains | I | pixels, each of which is comprised of R, G, B color channel values belonging to the set {0, 1, …, g ? 1} (where g = 256 for 24-bit RGB images with 8 bits per color channel). I is an observation of a true image I* in which pixels are perfectly represented by a family of distributions from which each of the observed color channel is sampled. The optimal statistical regions in I* share a homogeneity property such that inside any statistical region and given any color channel, the statistical pixels have the same expectation, whereas the expectations of adjacent statistical regions differ in at least one color channel. I is obtained from I* by sampling each statistical pixel for observed RGB values. The color channel values for every pixel in I* is replaced by a set of Q independent random variables, which take on values from (0, g/Q ). It is to be noted that the Q parameter can be used to quantify the statistical complexity of I* , the generality of the model, and the statistical difficulty of the problem. Higher values of Q result in finer segmentation and thus the generation of more regions. Like other region growing algorithms, SRM is based on two major components; a merging predicate and the order followed in testing this predicate. The predicate is defined as ( 15 ): (1) P ( R , R ? ) = { true if ? a ? { R , G , B } | R ¯ a ? ? R ¯ a | ? | b 2 ( R ) + b 2 ( R ? ) | false otherwise b ( R ) = g 1 2 Q | R | ln ( 6 | I | 2 R | R | ) where R and R? represent the two regions being tested, R? a denotes the observed average for color channel a in region R and R | p | is the set of regions with p pixels. The order of region merging follows an invariant A , which implies that when any test between two parts of true regions occurs, all tests inside each of the two regions have previously occurred. Let S I be a set that contains all pairs of adjacent pixels in the image based on 4-connectivity, p and p? be pixels in image I , and R ( p ) stand for the current region to which a pixel p belongs. The SRM algorithm first sorts these pairs in increasing order according to a function f ( p, p? ). After the sorting is completed, the order is traversed only once, performing the merging test P ( R ( p ), R ( p? )) for any pair of pixels ( p , p? ) for which R ( p ) ? R ( p? ), and merging R ( p ) and R ( p? ) if it returns true. The complexity of the ordering phase is O (| I | log( g )) when radix sort is used with color differences as the keys. Similarly, the merging phase can be performed in linear time using an efficient union-find algorithm. Because the model of image generation presented above assumes that the observed color variations within true regions should be significantly smaller than those between the regions, one way to approximate A is to calculate the between-pixel local gradients and then compute their maximum per-channel variation in f (.), i.e. f ( p , p ? ) = max a ? { R , G , B } f a ( p , p ? ) . The simplest choice for f (.) is to use the pixel channel values ( p a and p a ? ) directly: (2) f ( p , p ? ) = | p a ? p a ? | Pre-processing Black frame removal Dermoscopy images often contain black frames that are introduced during the digitization process. These need to be removed because they might interfere with the subsequent border detection steps. In order to determine the darkness of a pixel with ( R, G, B ) coordinates, the lightness component of the HSL color space ( 16 ) is utilized: (3) L = max ( R , G , B ) + min ( R , G , B ) 2 In particular, a pixel is considered to be black if its lightness value is <20. Using this criterion, the image is scanned row-by-row starting from the top. A particular row is labeled as part of the black frame if it contains 60% black pixels. The top-to-bottom scan terminates when a row that contains less than the threshold percentage of pixels is encountered. The same scanning procedure is repeated for the other three main directions. Image smoothing Dermoscopy images often contain extraneous artifacts such as skin lines, air bubbles and hairs around the lesion. These reduce the accuracy of the border detection and increase the computational time. In order to mitigate the detrimental effects of these artifacts, the images should be pre-processed with a smoothing filter. The median filter is one of the most common smoothing filters in the literature. Median filtering with a mask of appropriate size can eliminate most of the artifacts in a dermoscopy image ( 6 ). Note that the mask size should be proportional to the image size for optimal results. In this study, given an M by N image, the mask size n is determined by: (4) n = floor ( 5 · ( M / 768 ) · ( N / 512 ) ) Equation (4) is based on the observation that for a typical 768 × 512 image n = 5 is a good choice and it ensures that when the image size changes, this is reflected on the mask size proportionally. Post-processing The segmented image often contains regions that are part of the background skin. In order to eliminate these regions, the background skin color needs to be determined. In this study, the approach described in ( 17 ) is adopted. Four patches of size 20 × 20 pixels from the corners of the image are taken and the mean R, G , and B of the pixels is calculated. This mean color is taken as an estimate of the background skin color. The light-colored regions, i.e. the regions whose mean color has a distance <60 to the background skin color, are then eliminated. In addition, the regions that touch the image frame and those with rectangular borders are discarded. The initial border detection result is obtained by removing the isolated regions and then merging the remaining regions. Figure 1a–c illustrate this procedure. Note that in Fig. 1c the automatic border is mostly contained inside the manual border. This is observed in many cases because during the border determination procedure, the computer algorithms tend to find the sharpest pigment change, whereas the dermatologists choose the outmost detectable pigment. In order to bring the automatic border closer to the manual one, three different methods are applied to the initial border. The first one is majority filtering ( 18 ) in which the center pixel in an n × n neighborhood is assigned the majority label (object or background). Because the initial borders are jagged, this operation smoothes the borders, at the same time expanding them. The second method is morphological dilation ( 18 ) with a circular structuring element of size n . The third one is based on the Euclidean distance transform ( 19 ) in which the initial border is expanded until the lesion diameter reaches a certain percentage, i.e. (100 + k )%, of its initial value. For the first two methods, the operator size n is chosen as n = floor( k · ( d /500)), where d is the diameter of the lesion and k is a scaling factor. Figure 1d–f shows a comparison of these three expansion methods on a sample border. It can be seen that after these operations, the automatic borders are much closer to the manual border. The quantification of the border detection error will be explained in the next section.  Overview of the SRM algorithm SRM is a recent color image segmentation technique based on region growing and merging. The method models segmentation as an inference problem, in which the image is treated as an observed instance of an unknown theoretical image, whose statistical (true) regions are to be reconstructed. The advantages of this method include its simplicity, computational efficiency, and excellent performance without the use of quantization or color space transformations. Let I be an observed image that contains | I | pixels, each of which is comprised of R, G, B color channel values belonging to the set {0, 1, …, g ? 1} (where g = 256 for 24-bit RGB images with 8 bits per color channel). I is an observation of a true image I* in which pixels are perfectly represented by a family of distributions from which each of the observed color channel is sampled. The optimal statistical regions in I* share a homogeneity property such that inside any statistical region and given any color channel, the statistical pixels have the same expectation, whereas the expectations of adjacent statistical regions differ in at least one color channel. I is obtained from I* by sampling each statistical pixel for observed RGB values. The color channel values for every pixel in I* is replaced by a set of Q independent random variables, which take on values from (0, g/Q ). It is to be noted that the Q parameter can be used to quantify the statistical complexity of I* , the generality of the model, and the statistical difficulty of the problem. Higher values of Q result in finer segmentation and thus the generation of more regions. Like other region growing algorithms, SRM is based on two major components; a merging predicate and the order followed in testing this predicate. The predicate is defined as ( 15 ): (1) P ( R , R ? ) = { true if ? a ? { R , G , B } | R ¯ a ? ? R ¯ a | ? | b 2 ( R ) + b 2 ( R ? ) | false otherwise b ( R ) = g 1 2 Q | R | ln ( 6 | I | 2 R | R | ) where R and R? represent the two regions being tested, R? a denotes the observed average for color channel a in region R and R | p | is the set of regions with p pixels. The order of region merging follows an invariant A , which implies that when any test between two parts of true regions occurs, all tests inside each of the two regions have previously occurred. Let S I be a set that contains all pairs of adjacent pixels in the image based on 4-connectivity, p and p? be pixels in image I , and R ( p ) stand for the current region to which a pixel p belongs. The SRM algorithm first sorts these pairs in increasing order according to a function f ( p, p? ). After the sorting is completed, the order is traversed only once, performing the merging test P ( R ( p ), R ( p? )) for any pair of pixels ( p , p? ) for which R ( p ) ? R ( p? ), and merging R ( p ) and R ( p? ) if it returns true. The complexity of the ordering phase is O (| I | log( g )) when radix sort is used with color differences as the keys. Similarly, the merging phase can be performed in linear time using an efficient union-find algorithm. Because the model of image generation presented above assumes that the observed color variations within true regions should be significantly smaller than those between the regions, one way to approximate A is to calculate the between-pixel local gradients and then compute their maximum per-channel variation in f (.), i.e. f ( p , p ? ) = max a ? { R , G , B } f a ( p , p ? ) . The simplest choice for f (.) is to use the pixel channel values ( p a and p a ? ) directly: (2) f ( p , p ? ) = | p a ? p a ? |  Pre-processing Black frame removal Dermoscopy images often contain black frames that are introduced during the digitization process. These need to be removed because they might interfere with the subsequent border detection steps. In order to determine the darkness of a pixel with ( R, G, B ) coordinates, the lightness component of the HSL color space ( 16 ) is utilized: (3) L = max ( R , G , B ) + min ( R , G , B ) 2 In particular, a pixel is considered to be black if its lightness value is <20. Using this criterion, the image is scanned row-by-row starting from the top. A particular row is labeled as part of the black frame if it contains 60% black pixels. The top-to-bottom scan terminates when a row that contains less than the threshold percentage of pixels is encountered. The same scanning procedure is repeated for the other three main directions. Image smoothing Dermoscopy images often contain extraneous artifacts such as skin lines, air bubbles and hairs around the lesion. These reduce the accuracy of the border detection and increase the computational time. In order to mitigate the detrimental effects of these artifacts, the images should be pre-processed with a smoothing filter. The median filter is one of the most common smoothing filters in the literature. Median filtering with a mask of appropriate size can eliminate most of the artifacts in a dermoscopy image ( 6 ). Note that the mask size should be proportional to the image size for optimal results. In this study, given an M by N image, the mask size n is determined by: (4) n = floor ( 5 · ( M / 768 ) · ( N / 512 ) ) Equation (4) is based on the observation that for a typical 768 × 512 image n = 5 is a good choice and it ensures that when the image size changes, this is reflected on the mask size proportionally. Post-processing The segmented image often contains regions that are part of the background skin. In order to eliminate these regions, the background skin color needs to be determined. In this study, the approach described in ( 17 ) is adopted. Four patches of size 20 × 20 pixels from the corners of the image are taken and the mean R, G , and B of the pixels is calculated. This mean color is taken as an estimate of the background skin color. The light-colored regions, i.e. the regions whose mean color has a distance <60 to the background skin color, are then eliminated. In addition, the regions that touch the image frame and those with rectangular borders are discarded. The initial border detection result is obtained by removing the isolated regions and then merging the remaining regions. Figure 1a–c illustrate this procedure. Note that in Fig. 1c the automatic border is mostly contained inside the manual border. This is observed in many cases because during the border determination procedure, the computer algorithms tend to find the sharpest pigment change, whereas the dermatologists choose the outmost detectable pigment. In order to bring the automatic border closer to the manual one, three different methods are applied to the initial border. The first one is majority filtering ( 18 ) in which the center pixel in an n × n neighborhood is assigned the majority label (object or background). Because the initial borders are jagged, this operation smoothes the borders, at the same time expanding them. The second method is morphological dilation ( 18 ) with a circular structuring element of size n . The third one is based on the Euclidean distance transform ( 19 ) in which the initial border is expanded until the lesion diameter reaches a certain percentage, i.e. (100 + k )%, of its initial value. For the first two methods, the operator size n is chosen as n = floor( k · ( d /500)), where d is the diameter of the lesion and k is a scaling factor. Figure 1d–f shows a comparison of these three expansion methods on a sample border. It can be seen that after these operations, the automatic borders are much closer to the manual border. The quantification of the border detection error will be explained in the next section.  Black frame removal Dermoscopy images often contain black frames that are introduced during the digitization process. These need to be removed because they might interfere with the subsequent border detection steps. In order to determine the darkness of a pixel with ( R, G, B ) coordinates, the lightness component of the HSL color space ( 16 ) is utilized: (3) L = max ( R , G , B ) + min ( R , G , B ) 2 In particular, a pixel is considered to be black if its lightness value is <20. Using this criterion, the image is scanned row-by-row starting from the top. A particular row is labeled as part of the black frame if it contains 60% black pixels. The top-to-bottom scan terminates when a row that contains less than the threshold percentage of pixels is encountered. The same scanning procedure is repeated for the other three main directions.  Image smoothing Dermoscopy images often contain extraneous artifacts such as skin lines, air bubbles and hairs around the lesion. These reduce the accuracy of the border detection and increase the computational time. In order to mitigate the detrimental effects of these artifacts, the images should be pre-processed with a smoothing filter. The median filter is one of the most common smoothing filters in the literature. Median filtering with a mask of appropriate size can eliminate most of the artifacts in a dermoscopy image ( 6 ). Note that the mask size should be proportional to the image size for optimal results. In this study, given an M by N image, the mask size n is determined by: (4) n = floor ( 5 · ( M / 768 ) · ( N / 512 ) ) Equation (4) is based on the observation that for a typical 768 × 512 image n = 5 is a good choice and it ensures that when the image size changes, this is reflected on the mask size proportionally.  Post-processing The segmented image often contains regions that are part of the background skin. In order to eliminate these regions, the background skin color needs to be determined. In this study, the approach described in ( 17 ) is adopted. Four patches of size 20 × 20 pixels from the corners of the image are taken and the mean R, G , and B of the pixels is calculated. This mean color is taken as an estimate of the background skin color. The light-colored regions, i.e. the regions whose mean color has a distance <60 to the background skin color, are then eliminated. In addition, the regions that touch the image frame and those with rectangular borders are discarded. The initial border detection result is obtained by removing the isolated regions and then merging the remaining regions. Figure 1a–c illustrate this procedure. Note that in Fig. 1c the automatic border is mostly contained inside the manual border. This is observed in many cases because during the border determination procedure, the computer algorithms tend to find the sharpest pigment change, whereas the dermatologists choose the outmost detectable pigment. In order to bring the automatic border closer to the manual one, three different methods are applied to the initial border. The first one is majority filtering ( 18 ) in which the center pixel in an n × n neighborhood is assigned the majority label (object or background). Because the initial borders are jagged, this operation smoothes the borders, at the same time expanding them. The second method is morphological dilation ( 18 ) with a circular structuring element of size n . The third one is based on the Euclidean distance transform ( 19 ) in which the initial border is expanded until the lesion diameter reaches a certain percentage, i.e. (100 + k )%, of its initial value. For the first two methods, the operator size n is chosen as n = floor( k · ( d /500)), where d is the diameter of the lesion and k is a scaling factor. Figure 1d–f shows a comparison of these three expansion methods on a sample border. It can be seen that after these operations, the automatic borders are much closer to the manual border. The quantification of the border detection error will be explained in the next section.  Results and Discussion The proposed method is tested on a set of 90 dermoscopy images (23 invasive malignant melanoma and 67 benign) obtained from the EDRA Interactive Atlas of Dermoscopy ( 20 ) and the dermatology practices of Dr Ashfaq Marghoob (New York, NY), Dr Harold Rabinovitz (Plantation, FL), and Dr Scott Menzies (Sydney, Australia). These are 24-bit RGB color images with dimensions ranging from 577 × 397 pixels to 1921 × 1285 pixels. The benign lesions include nevocellular nevi and dysplastic nevi. As a ground truth for the evaluation of the border detection error, manual borders were obtained by selecting a number of points on the lesion border, connecting these points by a second-order B-spline and finally filling the resulting closed curve. Three sets of manual borders were obtained by dermatologists Dr William Stoecker, Dr Joseph Malters, and Dr James Grichnik using this method. Using the dermatologist-determined borders, the automatic borders obtained from the five automated methods [orientation-sensitive fuzzy c-means (OSFCM) ( 6 ), DTEA ( 12 ), meanshift clustering ( 13 ), JSEG ( 14 ), and SRM] are compared using the grading system developed by Hance et al. ( 21 ). Here, the percentage border error is given by: (5) Border Error = Area ( AutomaticBorder ? ManualBorder ) Area ( ManualBorder ) · 100 % where AutomaticBorder is the binary image obtained by filling the computer detected border, ManualBorder is the binary image described above, ? is the exclusive-OR operation that gives the pixels for which the AutomaticBorder and ManualBorder disagree, and Area( I ) denotes the number of pixels in the binary image I . For the SRM, in order to determine the most effective post-processing method, the k parameter is varied between 1 and 10 and the mean error (average of the mean percentage border error over each border set) values are calculated as plotted in Fig. 2 . As the figure shows, majority filtering is not very effective because it is not capable of expanding the borders to cause a significant reduction in the mean error. On the other hand, morphological dilation reduces the error rates particularly when k is between 3 and 6. For comparison purposes, morphological dilation with k = 6 will be used as the post-processing method. Table 1 gives the mean and standard deviation border error for the five automated methods. The best entry (lowest error value) in each row is shown in bold. It can be seen that the results vary significantly across the border sets, highlighting the subjectivity of human experts in the border determination procedure. Overall, the proposed SRM method achieves the best results followed by the DTEA and the JSEG methods. It is to be noted that, with the exception of the SRM, the error rates increase in the melanoma group possibly due to the presence of higher border irregularity and color variegation in these lesions. Figure 3 shows sample border detection results for the SRM method. It can be seen that the method performs well even in the presence of complicating factors such as diffuse edges, blood vessels and skin lines.  Conclusion In this paper, a fast and unsupervised approach to border detection in dermoscopy images based on the SRM algorithm is presented. The proposed approach is comprised of three main phases: preprocessing, segmentation, and post-processing. The pre-processing phase includes black frame removal and image smoothing. The segmentation phase includes pixel couple ordering and region merging. Finally, the post-processing phase consists of eliminating the regions that belong to the background skin, removing the isolated regions, merging the remaining regions, and expanding the initial border by morphological dilation to obtain the final result. The execution time of the proposed method is about 0.4 s for a typical image of size 768 × 512 pixels on an Intel Centrino 1.6 GHz computer (Santa Clara, CA, USA). This can be further reduced by using faster algorithms for median filtering ( 22 ) and morphological dilation ( 23 ). The method was tested on a set of 90 dermoscopy images. Three sets of dermatologist-determined borders were used as the ground-truth. The border detection error was quantified by a metric developed by Hance et al. ( 21 ) computed as the number of pixels for which the automatic and manual borders disagree divided by the number of pixels in the manual border. The results were compared with four other automated methods. The implementation of the SRM algorithm will be made publicly available as part of the Fourier image processing and analysis library, which can be downloaded from http://sourceforge.net/projects/fourier-ipal 